"use strict";angular.module("pclnApp",["ngCookies","ngResource","ngSanitize","ngRoute","fly"]).config(["$routeProvider","$locationProvider",function(a){a.otherwise({redirectTo:"/"})}]),angular.module("pclnApp").service("pcln",["$q",function(a){function b(a){return h=a}function c(a,b){if("function"==typeof Array.prototype.map)return Array.prototype.map.call(a,b);var c=[];return angular.forEach(a,function(a,d){c.push(b.call(a,d))}),c}function d(a,b){return _.find(a,function(a){return a.code===b})||{code:b}}function e(b){var c=a.defer(),d=c.promise,e=!1,f=["success","error"],g=f.length-1,h="error";return angular.forEach(f,function(a){d[a]=function(f,i){return h===a&&(f.call(null,b),e=!0),e===!0&&i===g&&c.resolve(),d}}),h=b?"success":"error",d}function f(a,b,c,d){a=a||"",b=b||"";var e=document.createElement("option");return e.value=a,e.innerHTML=b,d===!0&&(e.disabled="disabled"),c===!0&&(e.selected="selected"),e}function g(a){var b={},c=a.addressLineOne||a.addressLine1,d=a.addressLineTwo||a.addressLine2,e=_.filter([c,d],function(a){return a});b.addressLine=e,angular.extend(b,{cityName:a.cityName,countryCode:a.countryCode});var f=a.postalCode;f&&(b.postalCode=f);var g=a.stateCode;return g&&(b.stateCode=g),b}var h=null,i=window.localstorage||window.localStorage,j={map:c,findCode:d,staticHttpPromise:e,constructOption:f,formatAddress:g,localstorage:i};return b(j)}]),angular.module("fly",["fly.search","fly.checkout","fly.postbooking","fly.reject"]).config(["$routeProvider",function(a){a.when("/booking/:itinerary*",{templateUrl:"components/fly/booking/fly-booking.html",controller:"FlyBookingController"}).when("/fare-rules/:itinerary*",{templateUrl:"components/fly/fare-rules/fly-fare-rules.html",controller:"FlyFareRulesController"})}]),angular.module("fly").factory("Itinerary",["Customer","SliceCollection","SegmentCollection","TravelerCollection","CreditCard","CreditCardCollection","PricingInfo","$filter",function(a,b,c,d,e,f,g,h){var i=function(a,b){b=b||{},this.itinId=_.uniqueId("itin"),angular.extend(this,a);var c=this.airline||b.airline,d=this.airport||b.airport,e=this.bookingRequest;e&&(angular.extend(this,e),delete this.bookingRequest);var f=this.slice;f&&this.setSlices(f,{airline:c,airport:d,equipment:this.equipment}),this._setFrequentFlyerPrograms(),this.setCustomer(this.customer);var g=a.numberInParty,h=this.passenger;g&&!h&&this.setPassengers(g,{airline:c,frequentFlyerPrograms:this.frequentFlyerPrograms,segment:this.segments.list}),h&&(this.setPassengers(h,{airport:d,segment:this.segments.list,airline:c}),this.numberInParty||(this.numberInParty=this.passengers.list.length));var i=this.pricingInfo;i&&this.setPricingInfo(i,{airline:c});var j=this.fulfillment;if(j){var k=j.paymentCard;k&&this.setPaymentCard(k),delete this.fulfillment}this.setAcceptedCreditCards(),this.setFareRulesParams(),this.setTicketingAirline(),this.bookingReferenceId&&"string"!=typeof this.bookingReferenceId&&(this.bookingReferenceId=this.bookingReferenceId.toString()),this.segments&&(this.international=this.segments.international,this.seatmapsAvailable=this.segments.international),this.setPaxMinimumAge(a.paxMinimumAge),this.determineOpenJaw(),this.authToken&&(this.authtoken=this.authToken,delete this.authToken)};return i.prototype={getAirlineConfirmationCode:function(){if(this.airlineConfirmationCode)return this.airlineConfirmationCode;var a=_.filter(this.segments,function(a){return!!a.carrierLocator}),b=_.uniq(_.map(a,function(a){return!!a.carrierLocator}));return b.length>0?b.toString().replace(/,/g," "):"Pending"},setAcceptedCreditCards:function(){var a=[];this.validCCTypes&&this.validCCTypes.length?(this.acceptedCreditCards=this.validCCTypes,delete this.validCCTypes):(angular.forEach(this.airline,function(b){b.acceptedCreditCards&&a.push(b.acceptedCreditCards)}),this.acceptedCreditCards=_.intersection.apply(_,a))},setCustomer:function(b){this.customer=new a(b)},setFareRulesParams:function(){var a=null;if(this.checkStatusToken)a=this.checkStatusToken;else{var b=this.itineraryReference,c=this.ticketingAirline;if(!b||!c)return;var d=b.refId,e=b.groupId,f=this.numberInParty;a=e+"/"+d+"/"+f+"/",c=c.code,angular.forEach(this.pricingInfo.fareInfo,function(b){a+=b.origAirport+"-"+b.destAirport+"-"+c+"-"+b.fareBasisCode+"/"})}this.fareRulesUrlParams=a},setPassengers:function(a,b){return a?void(this.passengers=new d(a,b)):!1},setPricingInfo:function(a,b){a=angular.isArray(a)===!0?a[0]:a,this.pricingInfo=new g(a,b),this.ticketingAirline=this.pricingInfo.ticketingAirline},setPaymentCard:function(a,b){this.paymentCard=new e(a,b)},setPaxMinimumAge:function(a){a=a||15,this.paxMinimumAge=a},setSegments:function(a){if(a=a||this.slice,!a)return!1;var b=[];if(this.slice.each(function(a){a.segment.each(function(a){b.push(a)})}),this.segments=new c(b),this.departDateTime=b[0].departDateTime,this.arrivalDateTime=b[b.length-1].arrivalDateTime,this.segments.setDisjointed(),this.disjointed=this.segments.disjointed,this.origAirport=this.segments.list[0].origAirport,this.tripType||"MD"!==this.itineraryTypeCode){var d=this.slice.list[0],e=d.segment.list;this.destAirport=e[e.length-1].destAirport}},setSlices:function(a,c){return a?(this.slice=new b(a,c),void this.setSegments()):!1},setTicketingAirline:function(){this.pricingInfo&&this.pricingInfo.ticketingAirline&&(this.ticketingAirline=this.pricingInfo.ticketingAirline)},determineOpenJaw:function(){if(this.segments&&"OW"!==this.itineraryTypeCode&&"MD"!==this.itineraryTypeCode){var a=this.segments.list,b=a[0].origAirport,c=a[a.length-1].destAirport;b.code!==c.code&&(this.openJaw=!0)}},getBackToSearchUrl:function(){if(!this.slice)return!1;var a="/qp.asp",b=this.slice.list,c=1,d=this.numberInParty,e=this.itineraryTypeCode,f=["productid="+c,"TripType="+e,"numtickets="+d],g=null,h=null;if("MD"===e)angular.forEach(b,function(a,b){var c=b+1,d=2*c-1;g=a.getOrigAirport(),h=a.getDestAirport(),f.push("MDCity_"+d+"="+g.code,"MDCity_"+(d+1)+"="+h.code,"DepDateMD"+c+"="+a.departDateTime)});else{var i=b[0];g=i.getOrigAirport(),h=i.getDestAirport(),f.push("DepCity="+g.code,"DepartureDate="+i.departDateTime,"ArrCity="+h.code),"RT"===e&&f.push("ReturnDate="+b[1].departDateTime)}return a+="?"+f.toString().replace(/,/g,"&")},getSeatmapUrl:function(a){if(a=a||{},this._seatmapUrl&&a.newUrl!==!0)return this._seatmapUrl;var b=this.slice.toString(a),c=this.numberInParty,d=this.itineraryReference||{},e=d.refId,f=d.groupId,g=this.itinCacheKey;if(!g&&this.hashKey){var i=h("removeTrailingSlash")(this.hashKey).split("/");g=i[i.length-1]}return this._seatmapUrl=b+"/"+c+"/"+g+"/"+f+"/"+e+"/",this._seatmapUrl},_setFrequentFlyerPrograms:function(a,b){return(a=a||this.frequentFlyerPrograms)?(b=b||this.airline,void(this.frequentFlyerPrograms=_.map(a,function(a){var c=a.carrierCode,d=a.name,e={};if(b){var f=_.find(b,function(a){return a.code===c});f&&(e.carrier=f,d||(d=f.name))}return angular.extend(e,{carrierCode:c,name:d}),e}))):!1},_setSliceMap:function(a,b){var c=[],d=null,e=function(a){return b[a.uniqueSegId]};for(var f in a)d=a[f],d.segment=_.map(d.segment,e),c.push(d);this.slice=c}},i}]),angular.module("pclnApp").factory("Slice",["SegmentCollection",function(a){var b=function(b,c){angular.extend(this,b),c.slice=this,this.segment=new a(this.segment,c),this.segment.list[0].sliceStart=!0,this.travelTime=this.segment.travelTime,this.setOrigin(),this.setDestination(),this.international=this.segment.international,this.seatSelectionAvailable=this.segment.seatSelectionAvailable};return b.prototype={serialize:function(){return{id:this.id,segment:this.segment.serialize()}},getAirportHashKey:function(a){try{return this.segment.getAirportHashKey(a)}catch(b){throw new Error("Slice does not appear to have segment attribute. Please verify your data is mapped correctly as a slice must always have a segment.")}},setOrigin:function(){var a=this.segment.list,b=a[0];this.departDateTime=b.departDateTime,this.origAirport=b.origAirport},setDestination:function(){var a=this.segment.list,b=a[a.length-1];this.arrivalDateTime=b.arrivalDateTime,this.destAirport=b.destAirport},getDisjointedSegments:function(){return this.segment.getDisjointedSegments()},getOperatedBySegments:function(){return this.segment.getOperatedBySegments()},getDomesticWithInternationalConnection:function(){var a=this.origAirport.country;if(a!==this.destAirport.country)return!1;var b=[];return angular.forEach(this.segment.list,function(c){for(var d=[c.origAirport.country,c.destAirport.country],e=0,f=d.length;f>e;e++)d[e]!==a&&_.indexOf(b,d[e])<0&&b.push(d[e])}),b},getOrigAirport:function(){try{return this.segment.list[0].origAirport}catch(a){return!1}},getDestAirport:function(){try{var a=this.segment.list;return a[a.length-1].destAirport}catch(b){return!1}}},b}]),angular.module("pclnApp").factory("Segment",["$filter","Time","pcln",function(a,b,c){var d=function(a,b){angular.extend(this,a),this.marketingAirline&&this.setAirline(b.airline),this.operatingAirline&&this.setAirline(b.airline,this.operatingAirline,"operating"),this.airport&&this.setAirport(b.airport,null,"airport"),this.origAirport&&this.setAirport(b.airport,null,"origAirport"),this.destAirport&&this.setAirport(b.airport,this.destAirport,"destAirport"),this.origAirport&&this.destAirport&&this.setInternational(),this.equipmentCode&&this.setEquipment(b.equipment),this.equipmentCode&&this.setEquipment(b.equipment,null,"equipmentChg"),this.arrivalDateTime&&this.setDateTime(this.arrivalDateTime,"arrival"),this.departDateTime&&this.setDateTime(this.departDateTime,"depart"),this.duration&&(this.duration={stamp:this.duration,hours:Math.floor(this.duration/60),minutes:Math.floor(this.duration%60)}),this.setSeatSelectionAllowed(),this.stopInfo&&this.setStopInfo(null,b)};return d.prototype={serialize:function(){var a={arrivalDateTime:this.arrivalDateTime,bkgClass:this.bkgClass,departDateTime:this.departDateTime,destAirport:this.destAirport.code,flightNumber:this.flightNumber,id:this.id,marketingAirline:this.marketingAirline.code,origAirport:this.origAirport.code},b=this.operatingAirline;return b&&(a.operatingAirline=b.code),a},setAirline:function(a,b,d){return a=a||[],d=(d||"marketing")+"Airline",(b=b||this[d])?void(this[d]=c.findCode(a,b)):!1},setAirport:function(a,b,d){return a=a||[],d=d||"airport",(b=b||this[d])?void(this[d]=c.findCode(a,b)):!1},setInternational:function(){this.international=this.origAirport.country!==this.destAirport.country},setDateTime:function(a,b){b=(b||"depart")+"DateTime",this[b]=a},setEquipment:function(a,b,d){return b=b||this.equipmentCode,d=d||"equipment",b&&"object"==typeof a?(this[d]=c.findCode(a,b),void(this.equipmentCode&&delete this.equipmentCode)):!1},setSeatSelectionAllowed:function(){var a=this.seatSelectionAllowed||!0;this.seatSelectionAllowed=this.seatmapAvailble&&a},setStopInfo:function(a,e){this.stopInfo=c.map(a||this.stopInfo,function(a){var c=new d(a,e);return c.layover=b.diff(c.arrivalDateTime,c.departDateTime),c})},getDurationFromDeparture:function(){if(this._durationFromDeparture)return this._durationFromDeparture;this._durationFromDeparture={};try{var a=this.slice.departDateTime;angular.extend(this._durationFromDeparture,{origin:b.diff(a,this.departDateTime),destination:b.diff(a,this.arrivalDateTime)})}catch(c){}return this._durationFromDeparture},getFlightDuration:function(){return this._flightDuration?this._flightDuration:(this._flightDuration=b.diff(this.departDateTime,this.arrivalDateTime),this._flightDuration)},hasSeatMap:function(){return!this.seatmap||this.seatmap.errorCode?!1:!0}},d}]),angular.module("pclnApp").factory("PricingInfo",["pcln",function(a){var b=function(a,b){b=b||{};for(var c in a){var d=a[c];null!==d&&void 0!==d&&(this[c]=d)}this.ticketingAirline&&this.setTicketingAirline(b.airline),this.addedInsuranceCost||(this.addedInsuranceCost=0),this.insurancePaid||(this.insurancePaid=0),this.absoluteTotal=this.totalFare+(this.addedInsuranceCost||this.insurancePaid||0)};return b.prototype={serialize:function(){var a={agreedTotalFare:this.agreedTotalFare||this.totalFare,baseFare:this.baseFare,currencyCode:this.currencyCode,ticketingAirline:this.ticketingAirline.code,totalTaxes:this.totalTaxes},b=this.fees;this.fees&&(a.fees=b);var c=this.insuranceCost||this.addedInsuranceCost;return c&&(a.insuranceCost=c),a},addInsurance:function(a){return a&&this.addedInsuranceCost!==a?void(this.addedInsuranceCost=parseInt(a,10)):!1},removeInsurance:function(){delete this.addedInsuranceCost},getProcessingFee:function(){var a=this.fees||[],b=0,c=null;for(var d in a)if(c=a[d],c.feeCode.match(/offer/gi)){b=c.amount;break}return b},getShippingFee:function(){var a=_.find(this.fees,function(a){return"SHIPPING"===a.feeCode});return a?a.amount:0},setTicketingAirline:function(b,c){return b=b||this.airlines||[],(c=c||this.ticketingAirline)?void(this.ticketingAirline=a.findCode(b,c)):!1}},b}]),angular.module("pclnApp").factory("SliceCollection",["Collection","Slice","$filter",function(a,b,c){var d=function(a,c){c.collection=this,this.list=_.map(a||[],function(a){return a instanceof b==!1?new b(a,c):void 0})};return d.prototype={serialize:function(){return _.map(this.list,function(a){return a.serialize()})},getAirportHashKey:function(a){a=a||{};var b=a.delineator||":";return _.map(this.list,function(b){return b.getAirportHashKey(a)}).toString().replace(/,/g,b)},getOperatedBySegments:function(){var a=[];return angular.forEach(this.list,function(b){var c=b.getOperatedBySegments();c&&angular.forEach(c,function(b){a.push(b)})}),a},getDomesticWithInternationalConnection:function(){var a=[];return angular.forEach(this.list,function(b){var c=b.getDomesticWithInternationalConnection();angular.forEach(c,function(b){_.indexOf(a,b)<0&&a.push(b)})}),a},toString:function(a){a=a||{};var b="",d=this.list.length,e=c("date"),f=a.delineator||"/",g=a.sliceDelineator||"-";return angular.forEach(this.list,function(c,h){try{var i=c.origAirport.code,j=c.destAirport.code;if(b+=i+g+j,a.dates!==!1){var k=e(c.departDateTime,"yyyyMMdd");b+=g+k}d>h+1&&(b+=f)}catch(l){}}),b}},angular.extend(d.prototype,a),d}]),angular.module("pclnApp").factory("SegmentCollection",["pcln","Collection","Segment","Time",function(a,b,c,d){var e=function(b,d){d=d||{};var e=this;this.list=a.map(b||[],function(a){return d.slice&&(a.slice=d.slice),d.replaceCollection!==!0?a.collection=e:delete d.replaceCollection,a instanceof c==!1?new c(a,d):a}),this.list[this.list.length-1].sliceEnd=!0,this.setInternational(),this.setSeatSelectionAllowed(),this.setTravelTime()};return e.prototype={serialize:function(){return a.map(this.list,function(a){return a.serialize()})},getAirportHashKey:function(b){b=b||{};var c=b.separator||"-",d=b.delineator||":";return a.map(this.list,function(a){return a.origAirport.code+c+a.destAirport.code}).toString().replace(/,/g,d)},setInternational:function(){var a=!1;angular.forEach(this.list,function(b){b.international===!0&&(a=!0)});var b=this.list[0],c=this.list[this.list.length-1];this.domestic=b.origAirport.country===c.destAirport.country?!0:!1,this.international=a},setSeatSelectionAllowed:function(){var a=_.filter(this.list,function(a){return a.seatSelectionAvailable===!0});this.seatSelectionAvailable=a.length?a:!1},setTravelTime:function(a,b){var c=this.list,e=c[0],f=c[c.length-1];a=a||e.departDateTime,b=b||f.arrivalDateTime,this.travelTime=d.diff(a,b)},setDisjointed:function(){var a=this,b=this.list;this.disjointed=!1,angular.forEach(b,function(c,d){var e=b[d+1];e&&e.origAirport.code!==c.destAirport.code&&(c.disjointed=!0,c.nextDisjoint=e,e.prevDisjoint=c,a.disjointed=!0)})},getDisjointedSegments:function(){var a=[];return angular.forEach(this.list,function(b){b.disjointed===!0&&a.push(b)}),a},getOperatedBySegments:function(){var a=[];return angular.forEach(this.list,function(b){b.operatingAirline&&a.push(b)}),a.length?a:!1},addSeatMap:function(a){angular.isArray(a)||(a=[a]);var b=this;angular.forEach(a,function(a){angular.forEach(b.list,function(b){b.id===a.flight.segmentRefId&&(b.seatmap=a)})})}},angular.extend(e.prototype,b),e}]),angular.module("fly").filter("flySearchUrl",[function(){return function(a){console.log(a)}}]),angular.module("pclnApp").directive("pclnDesktopHeader",[function(){return{restrict:"E",replace:!0,templateUrl:"components/headers/desktop/pcln-desktop-header.html",link:function(a){a.primaryNav=[{title:"Hotels",src:"/hotels"},{title:"Cars",src:"/Cars"},{title:"Flights",src:"/Flights"},{title:"Vacation Packages",src:"/vacationpackages"},{title:"Cruises",src:"/cruises"}],a.moreNav=[{title:"Hotel Guides",src:"hotel-reviews-hotel-guides"},{title:"Hotels for Groups",src:"http://findgroupdeals.hotelplanner.com/Priceline.cfm",external:!0}],a.myTripsNav=[{title:"My Profile",src:""},{title:"Check your flight status",src:""},{title:"View, Print or Email your itinerary",src:""},{title:"Check your request",src:"/myprofile/checkRequest.do"}],a.helpNav=[{title:"Self-Service",src:""},{title:"Frequently Asked Questions",src:""},{title:"Find your request number",src:""},{title:"Profile password help",src:""},{title:"Contact Us",src:""}]}}}]),angular.module("pclnApp").directive("pclnDesktopFooter",[function(){return{restrict:"E",replace:!0,templateUrl:"components/footers/desktop/pcln-desktop-footer.html",link:function(a){a.primaryNav=[{title:"Hotels",src:"/hotels"},{title:"Cars",src:"/Cars"},{title:"Flights",src:"/Flights"},{title:"Vacation Packages",src:"/vacationpackages"},{title:"Cruises",src:"/cruises"}],a.moreNav=[{title:"Hotel Guides",src:"hotel-reviews-hotel-guides"},{title:"Hotels for Groups",src:"http://findgroupdeals.hotelplanner.com/Priceline.cfm",external:!0}],a.myTripsNav=[{title:"My Profile",src:""},{title:"Check your flight status",src:""},{title:"View, Print or Email your itinerary",src:""},{title:"Check your request",src:"/myprofile/checkRequest.do"}],a.helpNav=[{title:"Self-Service",src:""},{title:"Frequently Asked Questions",src:""},{title:"Find your request number",src:""},{title:"Profile password help",src:""},{title:"Contact Us",src:""}]}}}]),angular.module("fly.search",[]).config(["$routeProvider",function(a){a.when("/search/:itinerary*",{templateUrl:"components/fly/search/fly-search.html",controller:"FlySearchController"})}]),angular.module("fly.search").controller("FlySearchController",["$scope","$routeParams","FlySearchService",function(a,b,c){function d(b){f.status="success",a.itineraries=b.pricedItinerary}function e(){f.status="error"}var f=a.sync={status:c.getStatus()};a.showPage=function(){return"success"===f.status},a.showLoading=function(){return"syncing"===f.status},f.status||(f.status="syncing",c.get(b.itinerary).success(d).error(e))}]),angular.module("fly.search").service("FlySearchService",["$http","$q","Itinerary","pcln",function(a,b,c,d){function e(a){return k=a}function f(a){return a=a[l]||a,a.errors&&a.errors.length?g(a):(h(a),s.status="success",console.groupCollapsed("%cSUCCESS________FLY SEARCH____________","color: #7EC500; font-weight: bold;"),console.log(a),console.groupEnd(),angular.forEach(r._success,function(b){b.call(null,a)}),void p.resolve())}function g(a){s.status="error",console.groupCollapsed("%cERROR________FLY SEARCH____________","color: #EB0000; font-weight: bold;"),console.log(a),console.log(o),console.groupEnd(),angular.forEach(r._error,function(a){a.call(null)})}function h(a){var b=a.sliceMap,d=a.segmentMap,e=function(a){angular.extend(a,d[a.uniqueSegId])};for(var f in b){var g=b[f];angular.forEach(g.segment,e)}a.pricedItinerary=_.map(a.pricedItinerary,function(b){return b.slice=_.map(b.slice,function(b){return a.sliceMap[b.uniqueSliceId]}),new c(b,{airport:a.airport,airline:a.airline,equipment:a.equipment})})}function i(c,e){e=e||{};var h=m+c;return n!==c?(s.status="syncing",n=c,p=b.defer(),r=p.promise,angular.forEach(["success","error"],function(a){r[a]=function(b){var c="_"+a;return r[c]||(r[c]=[]),r[c].push(b),r}}),q=a.get(h).success(f).error(g),r):d.staticHttpPromise(o)}function j(){return s.status}var k=null,l="airSearchRsp",m="/pws/v0/fly/search/",n=null,o=null,p=null,q=null,r=null,s={status:null},t={get:i,getStatus:j};return e(t)}]),angular.module("fly").filter("sortItinerary",function(){return function(a,b){if("all"===b)return a;var c=[],d="";return angular.forEach(a,function(a){if("departing"===b){var e=a.slice.list[0].uniqueSliceId,f=new RegExp(e,"gi");d.match(f)||(d+="_"+e,c.push(a))}}),console.log(c.length),c}}),angular.module("fly").directive("flyListing",function(){return{restrict:"E",scope:{itineraries:"="},replace:!0,templateUrl:"components/fly/listing/fly-listing.html",link:function(a){a.filter={flightSort:"departing"},a.filteredResults=[]}}}),angular.module("fly").directive("flyListingItinerary",function(){return{restrict:"E",scope:{itinerary:"="},replace:!0,templateUrl:"components/fly/listing/listing-itinerary/fly-listing-itinerary.html",link:function(){}}}),angular.module("fly.booking",[]).config(["$routeProvider",function(a){a.when("/booking/:itinerary/:static?/:debug?",{templateUrl:"components/fly/booking/fly-booking.html",controller:"FlyBookingController"})}]),angular.module("pclnApp").controller("FlyBookingController",["$scope","$location","$routeParams","BookingService","FlyCheckStatusService",function(a,b,c,d,e){function f(a){var b="static"===c.static,d="debug"===c.debug;return b&&(a+="static/"),d&&(a+="debug/"),a}function g(a){a=a||k.checkStatusToken||"";var c=function(){var c="/post-booking/accept/"+a+"/";b.path(f(c)).replace()};e.get(a).success(c).error(c)}function h(a,c){c=c||k.checkStatusToken||"";var d="/reject/"+a+"/"+c;b.path(f(d)).replace()}function i(a){var b=a.bookingStatus||{},c=b.statusCode;c.match(/REJECTED/gi)?h(b.reasonCode):g()}function j(){m.status="error"}var k=a.itinerary=d.getItinerary()||{},l=k.checkStatusToken,m=a.sync={status:"syncing"};if(a.bookingReferenceId=k.bookingReferenceId,a.isAlreadyBooked=function(){return d.isAlreadyBooked(c.itinerary)},a.showBooking=function(){return"syncing"===m.status},a.showBookingError=function(){return"error"===m.status},"string"!=typeof l||k.resubmit){var n=d.getStatus();if(n)a.sync.status="syncing",n.success(i).error(j);else{var o=c.itinerary,p="checkout/contract/"+o+"/";b.path(f(p)).replace()}}else g(l)}]),angular.module("pclnApp").service("BookingService",["$http","$routeParams","$q","$location","FlyBookingOfferService","RequestHandler","Itinerary","StoredContract",function(a,b,c,d,e,f,g,h){function i(a){return A=a}function j(){D.route&&d.path(D.route);var a=q(),c=B,e="post";b.hasOwnProperty("static")===!0&&(c=C,e="get");var f=x(E.hashKey);return f===!1||E.resubmit===!0?"post"===e?k(c,a,D):l(c):void 0}function k(b,c){return M=a.post(b,c),M.success(m).error(n)}function l(b){return M=a.get(b),M.success(m).error(n)}function m(a){a=a[z]||a;var b=a.errors;return b&&b.length?n(b):(O.status="success",E.checkStatusToken=a.checkStatusToken,console.groupCollapsed("SUCCESS________BOOKING RESPONSE____________"),console.log(a),console.groupEnd(),angular.forEach(N._success,function(b){b.call(null,a)}),L.resolve(),void(N=null))}function n(a){O.status="error",console.groupCollapsed("ERROR________BOOKING ERROR____________"),console.log(a),console.groupEnd(),angular.forEach(N._error,function(b){b.call(null,a)}),N=null}function o(a){a=a||{};var b=h.create()||{};return b.initials=a.initials||E.signature,b.contractDateTime=new Date,b}function p(){var a=E.paymentCard,b=a.serialize();return{paymentCard:b}}function q(){var a=E.authtoken,b=a&&!E.paymentCard.newCard,c=o(E.contractInformation);G=p(),F=E.customer.serialize(b,E.paymentCard),H=E.passengers.serialize(),I=E.pricingInfo.serialize(),J=E.referrals||f.getReferralsArray(),K=E.slice.serialize();var d={bookingReferenceId:E.bookingReferenceId,contractInformation:c,customer:F,fulfillment:G,itineraryReference:E.itineraryReference,passenger:H,pricingInfo:I,referrals:J,slice:K,ticketType:E.ticketType,deepLink:!0};a&&(d.authToken=a),E.useStrictDuplicate===!0&&(d.useStrictDuplicate=!0),E.prevBookingReferenceId&&(d.prevBookingReferenceId=E.prevBookingReferenceId);var e=E.genericSeatRequest||E.passengers.getGenericSeats();e&&(d.genericSeatRequest=e);var g=E.specificSeatRequest||E.passengers.getSpecificSeats();g&&(d.specificSeatRequest=g);var h={};return h[y]=d,console.groupCollapsed("____________BOOKING REQUEST____________"),console.log(h),console.groupEnd(),h}function r(){return e.getOfferNumber().success(s).error(t)}function s(a){var b=E.bookingReferenceId,c=a.offerNumber;b&&(E.prevBookingReferenceId=c),E.bookingReferenceId=c}function t(){n()}function u(a,b){return!a||E&&E.itinId===a.itinId?!1:(O.status="syncing",D=b||{},E=a,E=A.itinerary=a,L=c.defer(),N=L.promise,angular.forEach(["success","error"],function(a){N[a]=function(b){if(O.status===a)return void b.call();var c="_"+a;return N[c]||(N[c]=[]),N[c].push(b),N}}),r().success(j).error(n),N)}function v(){return E}function w(){return N}function x(a){return!!window.localStorage.getItem(a)}var y="airBookReq",z="airBookRsp",A=null,B="/pws/v0/air/booking/",C="_data/booking-response.json",D=null,E={},F=null,G=null,H=null,I=null,J=null,K=null,L=null,M=null,N=null,O={status:null},P={itinerary:E,xhr:M,book:u,isAlreadyBooked:x,getStatus:w,getItinerary:v};return i(P)}]),angular.module("pclnApp").service("FlyBookingOfferService",["$http","$routeParams",function(a,b){function c(a){return g=a}function d(b){return j=a.post(b)}function e(b){return j=a.get(b)}function f(){var a=h,c="post";return"static"===b.static&&(a=i,c="get"),"post"===c?d(a):e(a)}var g=null,h="/pws/v0/offer/number",i="_data/booking-offer.json",j=null,k={getOfferNumber:f};return c(k)}]),angular.module("pclnApp").service("FlyBookingAcknowledgementService",["$http","$q","pcln",function(a,b,c){function d(a){return j=a}function e(b){return a.post(k+b).success(f).error(g)}function f(a){console.groupCollapsed("SUCCESS________BOOKING ACKNOWLEDGEMENT____________"),console.log(a),console.groupEnd();try{window.localStorage.setItem(p+l,!0)}catch(b){}angular.forEach(o._success,function(b){b.call(null,a)})}function g(){angular.forEach(o._error,function(a){a.call(null)})}function h(a){var d=i(a);return d===!1?(l=a,m=b.defer(),o=m.promise,angular.forEach(["success","error"],function(a){o[a]=function(b){var c="_"+a;return o[c]||(o[c]=[]),o[c].push(b),o}}),n=e(a),o):c.staticHttpPromise(d)}function i(a){try{return!!window.localStorage.getItem(p+a)}catch(b){return!1}}var j=null,k="/pws/v0/air/booking/ack/",l=null,m=null,n=null,o=null,p="flyBookingAck:",q={checkIn:h,alreadyAcknowledged:i};return d(q)}]),angular.module("fly.checkout",[]).config(["$routeProvider",function(a){a.when("/checkout/contract/:itinerary*",{templateUrl:"components/fly/checkout/checkout-contract/fly-checkout-contract.html",controller:"FlyCheckoutController"}).when("/checkout/details/:itinerary*",{templateUrl:"components/fly/checkout/checkout-details/fly-checkout-details.html",controller:"FlyCheckoutController"}).when("/checkout/seatmap/:segmentRefId/:passengerId/:itinerary*",{templateUrl:"components/fly/checkout/checkout-seatmap/fly-checkout-seatmap.html",controller:"FlyCheckoutController",reloadOnSearch:!1})}]),angular.module("fly.checkout").controller("FlyCheckoutController",["$scope","$route","$location","$routeParams","FlyPriceConfirmationService","BookingService","Doorman","CheckoutState","FlyCheckoutInsuranceService",function(a,b,c,d,e,f,g,h,i){function j(b){m=a.itinerary=b,h.checkItinerary(b),p=h.requiresDetails(m),a.bookingReferenceId=a.itinerary.bookingReferenceId,a.alreadyBooked=a.isAlreadyBooked(),a.customer=m.customer,a.slices=m.slice,a.passengers=m.passengers,a.pricingInfo=m.pricingInfo,a.ticketType=m.ticketType,a.itinerary.paymentCard||a.itinerary.setPaymentCard({}),a.paymentCard=a.itinerary.paymentCard,a.numberInParty=m.numberInParty,a.internationalCountries=a.slices.getDomesticWithInternationalConnection(),a.flightSearchUrl=m.getBackToSearchUrl(),a.specificSeatsAssigned=!!a.passengers.getSpecificSeats().length,a.seatMapUrl="#/checkout/seatmap/:pid/:sid/"+a.itineraryHashKey,p&&(a.detailsUrl="#/checkout/details/"+a.itineraryHashKey),a.mustVerifyPassport()&&a.$on("verified:passport",function(b,c){a.passportVerified=c}),n.status="success",a.$broadcast("sync:success:FlyPriceConfirmation",e)}function k(){n.status="error",a.$broadcast("sync:error")}function l(b,c){m.authtoken=c.authtoken,a.signedin=!0,a.customerValid=!1,a.$broadcast("signin:success",c),a.customer.replaceWith(c.customer)}var m=a.itinerary={},n=a.sync={status:"syncing"},o={},p=!1;a.signedin=!!g.user,a.itineraryHashKey=d.itinerary,a.internationalCountries=[],a.alreadyBooked=!1,a.passportVerified=h.passportVerified(),a.customerValid=!1,a.passengersValid=!1,a.paymentValid=!1,a.contractSigned=!1,a.specificSeatsAssigned=!1,a.$on("valid:customer",function(b,c){a.customerValid=c}),a.$on("valid:passengers",function(b,c){a.passengersValid=c}),a.$on("valid:payment",function(b,c){a.paymentValid=c}),a.$on("valid:contract",function(b,c){a.contractSigned=c}),a.bookIt=function(){a.submitted=!0,a.$broadcast("attempt:booking");var b=a.okToBook();if(console.groupCollapsed("Contract Validity"),console.log("BOOKING ALLOWED:   "+b),console.log("Customer Valid:    "+a.customerValid),console.log("Passengers Valid:  "+a.passengersValid),console.log("Payment Valid:     "+a.paymentValid),console.log("Contract Signed:   "+a.contractSigned),console.groupEnd(),b!==!1){var c="/booking/"+d.itinerary+"/";a.static===!0&&(c+="static/"),a.debug===!0&&(c+="debug"),f.book(m,{route:c}).error(function(){n.status="error"})}},a.showPage=function(b){var e=new RegExp(b,"gi");return a.alreadyBooked!==!0&&(d.page===b||e.test(c.url()))&&"success"===n.status},a.isAlreadyBooked=function(b){return b=b||a.itineraryHashKey||a.itinerary.hashKey,f.isAlreadyBooked(b)||!!a.itinerary.bookingReferenceId},a.okToBook=function(){return a.mustVerifyPassport()&&a.passportVerified===!1?!1:a.customerValid===!0&&a.passengersValid===!0&&a.paymentValid===!0&&a.contractSigned===!0},a.isPaperTicket=function(){return"P"===a.ticketType},a.showCustomerForm=function(){return a.signedin===!1},a.showAjaxError=function(){return"error"===n.status},a.showLoading=function(){return a.alreadyBooked===!1&&"syncing"===n.status},a.showPassengerInformation=function(){return p===!0||p===!1&&a.specificSeatsAssigned===!0},a.showPassengerPreferences=function(){return"details"===d.page||a.passengersValid===!1||p===!1},a.showCustomerContact=function(){return a.signedin===!0},a.mustVerifyPassport=function(){return a.internationalCountries.length>0},a.showRegisterForm=function(){return a.signedin===!1},a.showTopPassengers=function(){return p===!0&&a.itinerary.numberInParty>1},a.displayInsurance=function(){return i.isAvailable()&&h.viewedDetails()===!1},a.tripInsuranceModal={open:!1},a.$on("toggle:modal:insurance",function(){if(a.tripInsuranceModal.open=!a.tripInsuranceModal.open,a.tripInsuranceModal.open===!0)var b=a.$watch("pricingInfo.addedInsuranceCost",function(c){c&&(a.tripInsuranceModal.open=!1,b())}),c=a.$on("declined:insurance:checkout",function(b,d){d===!0&&(a.tripInsuranceModal.open=!1,c())})}),e.get(a.itineraryHashKey,o).success(j).error(k),a.$on("sync:success:Doorman",l)}]),angular.module("fly.checkout").service("CheckoutState",["$location","$routeParams",function(a,b){function c(c){var d=b.page;if(c!==j&&"seatmap"!==d&&!a.url().match(/seatmap/gi)){j=c,k=f(j);var e=null;k===!0?"details"!==d&&(m=!0,e="details"):"contract"!==d&&(m=!0,e="contract"),m===!0&&a.path("/checkout/"+e+"/"+b.itinerary).replace()}}function d(a){a===j&&(l=!0)}function e(){return k===!0&&l===!0}function f(a){a=a||j;try{var b=a.cabinClassChange,c=a.fltTimeChg,d=a.priceChg,e=a.priceHigher;return!!(b||c||d||e)}catch(f){}}function g(a){return null===a||void 0===a?n:void(n=a)}function h(){return n}function i(a){return a?void(o=a):o}var j=null,k=!1,l=!1,m=!1,n=!1,o=null,p={checkItinerary:c,completeDetails:d,viewedDetails:e,requiresDetails:f,verifyPassport:g,passportVerified:h,goToAfterDetails:i};return p}]),angular.module("fly.checkout").service("FlyPriceConfirmationService",["$http","$routeParams","$q","Itinerary","pcln",function(a,b,c,d,e){function f(a){return j=a
}function g(a){return a=a[k]||a,a.errors&&a.errors.length?h():(s.status="success",a.hashKey=n,o=j.itinerary=new d(a),console.groupCollapsed("SUCCESS________PRICE CONFIRMATION____________"),console.log(a),console.log(j),console.groupEnd(),console.log(o),angular.forEach(r._success,function(a){a.call(null,o)}),void p.resolve())}function h(){s.status="error",console.groupCollapsed("ERROR________PRICE CONFIRMATION____________"),console.groupEnd(),angular.forEach(r._error,function(a){a.call(null)})}function i(d,f){if(f=f||{},"syncing"===s.status&&f.forceXhr!==!0)return r;var i=l+d;return b.static&&b.static.match(/static/g)&&(i=m),n!==d?(s.status="syncing",n=d,p=c.defer(),r=p.promise,angular.forEach(["success","error"],function(a){r[a]=function(b){var c="_"+a;return r[c]||(r[c]=[]),r[c].push(b),r}}),q=a.get(i).success(g).error(h),r):e.staticHttpPromise(o)}var j=null,k="airPriceRsp",l="/pws/v0/air/details/",m="_data/fly-price-confirmation.json",n=null,o=null,p=null,q=null,r=null,s={status:null},t={itinerary:o,get:i};return f(t)}]),angular.module("fly.checkout").controller("FlyCheckoutDetailsController",["$scope","$location","$routeParams","CheckoutState",function(a,b,c,d){var e=!1,f=a.itinerary.pricingInfo,g=a.mustVerifyPassport(),h=a.itinerary.seatmapsAvailable,i=d.goToAfterDetails();a.insuranceAvailable=null,a.options={nextPage:h?"seatmap":"contract"},i&&(a.options.nextPage=i),a.goToNextPage=function(){if(e===!1||g&&a.passportVerified!==!0)a.$broadcast("attempt:booking");else{d.completeDetails(a.itinerary);var f="";f="seatmap"===a.options.nextPage?"checkout/seatmap/0/0/"+c.itinerary:"checkout/contract/"+c.itinerary,b.path(f)}},a.displayInsurance=function(){return null!==a.insuranceAvailable},a.hasPriceChange=function(){return a.itinerary.priceChg},a.higherPriceChange=function(){return"higher"===a.itinerary.priceChg||a.itinerary.priceHigher===!0},a.hasCabinClassChange=function(){return a.itinerary.cabinClassChg===!0},a.$on("available:insurance:checkout",function(b,c){a.insuranceAvailable=c}),a.$on("valid:passengers",function(a,b){e=b}),a.$on("$destroy",function(){try{a.insuranceAvailable!==!0||f.insuranceStatus||(f.insuranceStatus="ignored"),h&&d.goToAfterDetails(a.options.nextPage)}catch(b){}})}]),angular.module("fly.checkout").controller("FlyCheckoutSeatmapController",["$scope","$routeParams","FlySeatmapService",function(a,b,c){function d(b){g.status="success",a.seatmaps=b.seatMap,a.$emit("sync:success:seatmap")}function e(){g.status="error",a.$emit("sync:error:seatmap")}function f(){var b=a.itinerary;a.slice=b.slice,a.seatmapUrl=b.getSeatmapUrl(),c.get(a.itinerary).success(d).error(e)}var g=a.seatMapSync={status:"syncing"};a.contractUrl="/checkout/contract/"+b.itinerary,a.defaultPassengerId=b.segmentRefId,a.defaultSegmentRefId=b.passengerId,a.showAjaxError=function(){return"error"===g.status||"error"===a.sync.status},a.showLoading=function(){return"syncing"===g.status||"syncing"===a.sync.status},a.showSeatMapPage=function(){return a.showPage()&&"success"===g.status},"success"!==a.sync.status?a.$on("sync:success:FlyPriceConfirmation",f):"success"===a.sync.status&&f()}]),angular.module("fly.checkout").directive("flyPriceSummary",[function(){return{restrict:"E",scope:{pricingInfo:"=",ticketType:"@"},replace:!0,templateUrl:"components/fly/checkout/checkout-price-summary/fly-checkout-price-summary.html",link:function(a){var b=a.pricingInfo;a.totalFare=b.totalFare,a.passengerCost=b.baseFare}}}]),angular.module("fly.checkout").directive("flyCheckoutInsuranceOffer",["FlyCheckoutInsuranceService",function(a){return{restrict:"E",scope:{itinerary:"="},replace:!0,templateUrl:"components/fly/checkout/checkout-insurance/fly-checkout-insurance.html",link:function(b,c,d){function e(){b.templates=a.templates;var c=b.templates[1];c&&(b.title=c.title.name,b.description=c.title.value,b.badge=c.badge,b.$emit("available:insurance:checkout",!0))}b.pricingInfo=b.itinerary.pricingInfo,b.detailsHidden=!1,b.addInsurance=function(){var c=a.getPrice("fly");if(!c)return!1;var d=c.unitFeeAmt;b.pricingInfo.addInsurance(d)},b.removeInsurance=function(){b.pricingInfo.removeInsurance(),b.$emit("declined:insurance:checkout",!0)},b.toggleDetails=function(){c.toggleClass("details-hidden"),b.detailsHidden=!b.detailsHidden},b.useRadios=function(){return b.radioInput===!0},b.useButtons=function(){return b.radioInput!==!0},a.get(b.itinerary).success(e),d.hasOwnProperty("radio")&&(b.radioInput=!0,b.$watch("pricingInfo.insuranceStatus",function(a){"accepted"===a?b.addInsurance():b.removeInsurance()}))}}}]),angular.module("fly.checkout").service("FlyCheckoutInsuranceService",["$http","$q","pcln","RequestHandler",function(a,b,c,d){function e(a){return m=a}function f(a){if(!a)throw new Error("No itinerary specified for TripInsurance query assembly");var b=a.advancePurchaseHours||0,c=a.apc||"DESKTOP_NEWSTACK",e="d3cd617b74c744e68b7a1d4d4a86be7b",f=a.gblPartnerCode||"PCLN",g=a.itineraryTypeCode,h=a.offerMethodCode||"RTL",i=a.lengthOfStayHours,j=d.data,k=j?j.referralId:"",l=j?j.referralClickId:"",m=j?j.webStats:{},n=m.vid||"",o=["adv-purchase-hours="+b,"apc="+c,"cguid="+e,"gbl-partner-code="+f,"itin-type-code="+g,"offer-method-code="+h,"rcid="+l,"rid="+k,"trip-duration-hours="+i,"vid="+n],p=a.paymentCard.address;if(p){var q=p.countryCode,r=p.stateCode,s=p.postalCode;q&&o.push("country-code="+q),r&&o.push("state-code="+r),s&&o.push("zip="+s)}else o.push("country-code=US");return"?"+o.toString().replace(/,/g,"&")}function g(a){w.status="success",i(a),console.groupCollapsed("____________CHECKOUT INSURANCE____________"),console.log(m),console.log(a),console.groupEnd(),angular.forEach(v._success,function(b){b.call(null,a)}),t.resolve(),v=null}function h(){w.status="error",angular.forEach(v._error,function(a){a.call()}),v=null}function i(a){return s=m.details=a[n]||a,s.templates&&(r=m.templates=s.templates),s}function j(c,d){if("syncing"===w.status)return v;if(c||console.warn("No itinerary specified for TripInsurance get"),t=b.defer(),v=t.promise,angular.forEach(["success","error"],function(a){v[a]=function(b){if(w.status===a)return void b.call();var c="_"+a;return v[c]||(v[c]=[]),v[c].push(b),v}}),c.hashKey!==q.hashKey){w.status="syncing",q=c,d=d||{};var e=q.slice.getAirportHashKey(),i=f(q),j=o+e+i;p=j,u=a.get(j),u.success(g).error(h)}return v}function k(){if(s){var a=s.ti||{},b=a.availability;return"Y"===b||b===!0}return!1}function l(a,b){var c=s.ti,d=_.find(c.products,function(b){return b.productCode===a});if(!d)return!1;var e=q.pricingInfo,f=e.totalFare;b=b||f;var g=_.find(d.priceBands,function(a){var c=parseInt(a.maxPrice,10),d=parseInt(a.minPrice,10);return c>=b&&b>=d});return g||!1}var m=null,n="insurance",o="/pws/v0/insurance/fly/",p="",q={},r={},s=null,t=null,u=null,v=null,w={status:null},x={details:s,templates:r,get:j,isAvailable:k,getPrice:l};return e(x)}]),angular.module("fly.checkout").controller("FlyCheckoutCustomerFormController",["$scope","Territories",function(a,b){function c(){a.toggleSignInModal()}a.submitted=!1,a.modalSettings={address:!1},a.signedIn={status:!1},a.toggleModal=function(){a.modalSettings.address=!a.modalSettings.address},a.postalCodeRequired=function(){return b.hasPostalCode(a.paymentCard.countryCode)},a.provinceRequired=function(){return b.getProvinces(a.paymentCard.countryCode)},a.notSignedIn=function(){return a.signedIn.status===!1},a.signInModal={open:!1},a.toggleSignInModal=function(){a.signInModal.open=!a.signInModal.open},a.paymentCard.countryCode||(a.paymentCard.countryCode="US"),a.customer.phoneList=[{name:"Daytime Phone",phoneTypeCode:"D"},{name:"Evening Phone",phoneTypeCode:"E"}],a.phoneD=a.customer.phoneList[0],a.phoneE=a.customer.phoneList[1],a.$watch("checkoutCustomerForm.$valid",function(b){a.$emit("valid:customer",b)}),a.$on("attempt:booking",function(){a.submitted=!0}),a.$on("signin:success",function(){a.signedIn.status=!0}),a.$on("sync:success:Doorman",c)}]),angular.module("fly.checkout").directive("flyCustomerContactForm",[function(){return{restrict:"E",scope:{customer:"="},templateUrl:"components/fly/checkout/checkout-customer-contact-form/fly-customer-contact-form.html",link:function(a){a.submitted=!1,a.phones=a.customer.phoneList,a.dayPhone=null,a.eveningPhone=null,angular.forEach(a.phones,function(b){"D"===b.phoneTypeCode?a.dayPhone=b:"E"===b.phoneTypeCode&&(a.eveningPhone=b)}),a.$watch("customerContactForm.$valid",function(b){a.$emit("valid:customer",b)}),a.$on("attempt:booking",function(){a.submitted=!0})}}}]),angular.module("pclnApp").directive("flyCheckoutImportantInformation",[function(){return{restrict:"E",scope:{itinerary:"="},templateUrl:"components/fly/checkout/checkout-important-information/fly-checkout-important-information.html",link:function(a){var b=a.itinerary.ticketingAirline.code;a.submitted=!1,a.ticketType=a.itinerary.ticketType,a.origAirport=a.itinerary.segments.list[0].origAirport,a.changesAllowed=function(){return a.itinerary.changesAllowed===!0||a.changePenalties()},a.changesNotAllowed=function(){return!a.itinerary.changesAllowed&&!a.changePenalties()},a.changePenalties=function(){return"NK"===b||"AI"===b||a.ticketType},a.noChangePenalties=function(){return a.changesAllowed()&&!a.changePenalties()},a.isSpiritAirlines=function(){return"NK"===b},a.isInternational=function(){return a.itinerary.international===!0},a.isNotInternational=function(){return a.itinerary.international===!1},a.isElectronicTicket=function(){return"E"===a.ticketType},a.isPaperTicket=function(){return"P"===a.ticketType},a.requiresDisinsection=function(){return a.itinerary.requiresDisinsection===!0},a.seatAssignmentUnavailable=function(){return!a.itinerary.seatAssignmentAvailable},a.hasOutboundFlight=function(){return a.itinerary.segments.list.length>1},a.$watch("customerSignatureForm.$valid",function(b){a.$emit("valid:contract",b),b===!0?a.itinerary.signedOn=new Date:delete a.itinerary.signedOn}),a.$on("attempt:booking",function(){a.submitted=!0})}}}]),angular.module("fly").directive("flyCheckoutVerifyPassport",["CheckoutState",function(a){return{restrict:"E",templateUrl:"components/fly/checkout/checkout-verify-passport/fly-checkout-verify-passport.html",link:function(b){b.submitted=!1,b.$on("attempt:booking",function(){b.submitted=!0}),b.$watch("verifyPassportForm.$valid",function(c){a.verifyPassport(c),b.$emit("verified:passport",c)})}}}]),angular.module("fly").directive("flyCreditCardForm",["CreditCardCollection",function(a){return{restrict:"E",scope:{customer:"=",paymentCard:"=",acceptedCreditCards:"="},templateUrl:"components/fly/credit-card-form/fly-credit-card-form.html",controller:["$scope",function(a){a.modalSettings={address:!1,card:!1},a.signedIn=!1,a.submitted=!1,a.toggleModal=function(){a.modalSettings.card=!a.modalSettings.card},a.toggleCreditCardModal=function(){a.modalSettings.card=!a.modalSettings.card},a.toggleShippingAddressModal=function(){a.modalSettings.address=!a.modalSettings.address},a.selectCard=function(b,c){if(c=c||{},b=b||a.selectedCard){a.paymentCard.replaceWith(b,{ignore:"authtoken"});var d=b.customer;d&&a.customer.replaceCustomer(d)}else;if(c.setCustomer!==!1){var e=a.paymentCard.address;e&&a.customer.set(e)}},this.addCard=function(b,c){a.creditCards.addCard(b,c)}}],link:function(b){b.selectedCard=null,b.creditCards=new a,b.displayFullForm=function(){return b.creditCards&&0===b.creditCards.list.length},b.displayUserForm=function(){return b.creditCards&&b.creditCards.list.length>0},b.isDisabled=function(a){return"emailAddress"===a?b.user?!!b.user.emailAddress:!1:b.paymentCard[a]?!0:void 0},b.$watch("guestPaymentForm.$valid",function(a){b.signedIn===!1&&b.$emit("valid:payment",a)}),b.$watch("userPaymentForm.$valid",function(a){b.signedIn===!0&&b.$emit("valid:payment",a)}),b.$on("signin:success",function(a,c){b.signedIn=!0,b.user=c,b.$emit("valid:payment",!1),b.creditCards.add(c.creditcardList.list)}),b.$on("attempt:booking",function(){b.submitted=!0})}}}]),angular.module("fly").directive("flyUserCreditCardSelect",["pcln",function(){return{require:"^flyCreditCardForm",restrict:"A",link:function(){}}}]),angular.module("fly.checkout").directive("addCreditCardModal",["Territories",function(a){return{require:"^flyCreditCardForm",restrict:"E",scope:{show:"=",acceptedCreditCards:"="},templateUrl:"components/fly/credit-card-form/add-credit-card/add-credit-card-modal.html",link:function(b,c,d,e){b.newCard={customer:{},newCard:!0},b.submitted=!1;var f=!1;b.postalCodeRequired=function(){return a.hasPostalCode(b.newCard.countryCode)},b.provinceRequired=function(){return a.getProvinces(b.newCard.countryCode)},b.addCreditCard=function(){b.submitted=!0,f&&(e.addCard(b.newCard),b.show=!b.show,b.newCard={customer:{},newCard:!0},b.$emit("creditcard:added"),b.submitted=!1)},b.$watch("addNewCreditCardForm.$valid",function(a){f=a})}}}]),angular.module("pclnApp").directive("flyPassengerPreferences",[function(){return{restrict:"E",scope:{passengers:"=",mealTypes:"=",paxMinimumAge:"@",confirmUnderSixteen:"@",international:"=",departDateTime:"@"},templateUrl:"components/fly/checkout/checkout-passenger-form/fly-checkout-passenger-preferences.html",link:function(a){function b(){var b=a.passengers.validateNames();a.$broadcast("invalid:passenger:uniquename",b),b===!0?(k=!0,i===!0&&j===!0&&e(!0)):(k===!0&&i===!0&&e(!1),k=!1)}function c(){var b=a.passengers;a.minors=b.getMinors(a.departDateTime);var c=b.olderThan(a.paxMinimumAge,a.departDateTime);0===c.length&&0!==a.minors.length||a.minors.length>0&&0===c.length&&a.confirmUnderSixteen===!0?(l=!0,j=!1,i===!0&&e(!1)):(b.infantCount>0&&a.international===!0?(m=!0,j=!1,i===!0&&e(!1)):(m=!1,j=!0,i===!0&&k===!0&&e(!0)),l=!1)}function d(){a.signedIn=!0,a.toggleSignInModal()}function e(b){a.$emit("valid:passengers",b)}function f(){l&&a.toggleAgeModal(),m&&a.toggleUnticketModal()}var g=a.validPassengers=[],h=a.passengers.list.length,i=!1,j=!1,k=!1,l=!1,m=!1;a.signedIn=!1,a.signInModal={open:!1},a.toggleSignInModal=function(){a.signInModal.open=!a.signInModal.open},a.ageModal={open:!1},a.toggleAgeModal=function(){a.ageModal.open=!a.ageModal.open},a.unticketModal={open:!1},a.toggleUnticketModal=function(){a.unticketModal.open=!a.unticketModal.open},a.$on("valid:passenger",function(a,b){var c=a.targetScope.passenger.id;if(b===!0)g.push(c),g.length===h&&(i=!0,k===!0&&j===!0&&e(!0));else{var d=_.indexOf(g,c);d>-1&&(g.length===h&&(i=!1,e(!1)),g.splice(d,1))}a.stopPropagation()}),a.$on("attempt:booking",f),a.$on("update:passenger:name",b),a.$on("update:passenger:age",c),a.$on("sync:success:Doorman",d),a.$watch("passengers.infantCount",c)}}}]),angular.module("pclnApp").directive("flyCheckoutPassengerInformation",[function(){return{restrict:"E",scope:{passengers:"=",seatMapUrl:"@"},templateUrl:"components/fly/checkout/checkout-passenger-information/fly-checkout-passenger-information.html",link:function(a){a.seatMapUrl&&(a.seatMapUrl=a.seatMapUrl.replace(/:sid/,"0")),a.showPassengerFullName=function(a){return a.firstName&&a.lastName},a.showDefaultName=function(b){return!a.showPassengerFullName(b)},a.showMealPreference=function(a){return a.mealPreference},a.getSeatMapUrl=function(b){return a.seatMapUrl.replace(/:pid/,b)}}}}]),angular.module("fly.checkout").directive("flyPassengerForm",["Doorman",function(a){return{restrict:"E",scope:{passenger:"=info",mealTypes:"=",international:"="},templateUrl:"components/fly/checkout/checkout-passenger-form/checkout-passenger-form.html",controller:["$scope",function(a){this.setPassenger=function(b){if(b){var c=a.travelerList.find(function(a){return a.pid===b});if(c){var d=["firstName","middleName","lastName","nameSuffix","gender"],e=_.map(d,function(a){return c[a]?a:!1}),f=c.pid;a.passenger.replaceWith(c,{ignore:["custLoyalty","seat"]}),a.passenger.utid=f,a.disabledInputs=_.intersection(d,e)}}else a.passenger.reset(),a.disabledInputs=[];a.$apply()}}],link:function(b){function c(a,c){b.signedIn.status=!0,b.travelerList=c.travelerList}function d(){b.$emit("update:passenger:name",b.passenger)}function e(){b.$emit("update:passenger:age",b.passenger)}b.signedIn={status:!!a.user},b.travelerList={},b.submitted=!1,b.uniqueName=!0,b.seatTypes=["A","W"],b.passenger.id>0&&b.seatTypes.push("T"),b.showUserTravelers=function(){return b.signedIn.status===!0},b.showMealTypes=function(){return b.mealTypes&&b.international===!0},b.isDisabled=function(a){return _.indexOf(b.disabledInputs,a)>-1},b.isDuplicateName=function(){return b.uniqueName===!1},b.$on("signin:success",c),b.$on("attempt:booking",function(){b.submitted=!0}),b.$on("invalid:passenger:uniquename",function(a,c){var d=b.passenger.getFullName().toLowerCase();d&&(c=_.find(c,function(a){return a===d}),b.uniqueName=c?!1:!0)}),b.$watch("passengerForm.$valid",function(a){b.$emit("valid:passenger",a)}),b.$watch("passenger.firstName",d),b.$watch("passenger.middleName",d),b.$watch("passenger.lastName",d),b.$watch("passenger.birthDateDay",e),b.$watch("passenger.birthDateMonth",e),b.$watch("passenger.birthDateYear",e),b.signedIn.status===!0&&c(null,a.user)}}}]),angular.module("fly.checkout").directive("flyUserTravelerSelect",["pcln","Doorman",function(a,b){return{require:"^flyPassengerForm",restrict:"A",link:function(c,d,e,f){function g(b,c){var g=[],h=null,i="",j="",k="",l="";g.push(a.constructOption(null,"-- Choose a Passenger --",!0,!0)),g.push(a.constructOption(null,"- New Passenger")),c.travelerList.each(function(b){i=b.firstName||"",j=b.middleName?b.middleName[0]:"",k=b.lastName||"",l=b.getFullName(),h=a.constructOption(b.pid,l),b.pid===e.traveler&&h.setAttribute("selected","selected"),g.push(h)}),d.append(g),d.bind("change",function(a){var b=angular.element(a.target),c=b.val();f.setPassenger(c)})}b.user?g(null,b.user):c.$on("signin:success",g)}}}]),angular.module("fly.checkout").directive("flyCheckoutRegisterForm",[function(){return{restrict:"E",scope:{customer:"="},templateUrl:"components/fly/checkout/checkout-register-form/fly-checkout-register-form.html",link:function(a){a.passwordRequirementModal={open:!1},a.password="",a.passwordConfirm="",a.passwordStrength=-1,a.passwordRequirements=["At least 8 characters in length","Alphabetic characters and at least one numeric character or one symbol"],a.submitted=!1,a.togglePasswordRequirementModal=function(){a.passwordRequirementModal.open=!a.passwordRequirementModal.open},a.passwordsMatch=function(){return a.password&&a.password!==a.passwordConfirm},a.$on("change:strength:password",function(b,c){a.passwordStrength=c}),a.$watch("registerCustomerForm.$valid",function(b){b===!0?a.customer.answerText=a.password:delete a.customer.answerText}),a.$on("attempt:booking",function(){a.submitted=!0})}}}]),angular.module("fly.checkout").directive("flyShippingAddressModal",[function(){return{restrict:"E",scope:{customer:"=",show:"="},templateUrl:"components/fly/checkout/checkout-add-shipping-address/fly-add-shipping-address-modal.html",link:function(a){a.shippingAddress={},a.addShippingAddress=function(){a.show=!a.show,a.customer.addShippingAddress(a.shippingAddress),a.$emit("customer:added:shippingAddress")}}}}]),angular.module("fly.checkout").directive("flyCheckoutSummaryOfCharges",["FlyCheckoutInsuranceService","CheckoutState",function(a,b){return{restrict:"E",scope:{pricingInfo:"=",numberInParty:"@",ticketType:"@",acceptedInsurance:"@",bannerImage:"=",airlineCount:"@",baggageFeeUrl:"@"},templateUrl:"components/fly/checkout/checkout-summary-of-charges/fly-checkout-summary-of-charges.html",link:function(c){function d(){return"ignored"!==e.insuranceStatus&&0===c.processingFee}var e=c.pricingInfo,f=b.requiresDetails();c.addedInsurance=null,c.baseFare=e.baseFare,c.totalTaxes=e.totalTaxes,c.total=e.totalFare||e.totalTripCost,c.subtotal=c.total,c.shippingFee=e.getShippingFee(),c.processingFee=e.getProcessingFee(),c.airlineCount=parseInt(c.airlineCount,10),c.showTicketDelivery=function(){return"P"===c.ticketType},c.showRemoveInsurance=function(){return e.addedInsuranceCost},c.showTravelInsuranceCost=function(){if(f===!1&&!e.addedInsuranceCost)return!1;var a=e.insuranceStatus;return e.addedInsuranceCost||a?null!==a:!1},c.showInsuranceCost=function(){return e.addedInsuranceCost},c.showInsuranceOffer=function(){return f===!1?!1:c.addedInsurance===!1&&("ignored"===e.insuranceStatus||"declined"===e.insuranceStatus)},c.addInsurance=function(){var b=a.getPrice("fly");if(!b)return!1;var c=b.unitFeeAmt;e.addInsurance(c)},c.removeInsurance=function(){c.pricingInfo.removeInsurance(),c.addedInsurance=!1},c.toggleInsuranceModal=function(){c.$emit("toggle:modal:insurance")},c.showBanner=function(){return c.showNoFeeBanner()||c.showEarnMiles()||c.showInsuranceBanner()},c.showNoFeeBanner=function(){return d()===!0&&1===c.airlineCount},c.showEarnMiles=function(){return d()===!0&&c.airlineCount>1},c.showInsuranceBanner=function(){return"ignored"===e.insuranceStatus},c.$watch("pricingInfo.addedInsuranceCost",function(a){if(a=!!a,null!==c.addedInsurance){var b="";b=a===!0?"accepted":"declined",c.pricingInfo.insuranceStatus=b}c.addedInsurance=!!a})}}}]),angular.module("fly.checkout").directive("flyCheckoutLoading",[function(){return{restrict:"E",scope:{itinerary:"="},templateUrl:"/components/fly/checkout/checkout-loading/fly-checkout-loading.html",link:function(a){if(a.itinerary){if(a.itineraryTypeCode=a.itinerary.itineraryTypeCode||a.itinerary.tripType,!a.itineraryTypeCode)return;a.origAirport=a.itinerary.origAirport,a.destAirport=a.itinerary.destAirport,a.departDateTime=a.itinerary.departDateTime,a.arrivalDateTime=a.itinerary.arrivalDateTime,a.numberInParty=a.itinerary.numberInParty,a.isMultiDest=function(){return"MD"===a.itineraryTypeCode},a.isRoundTrip=function(){return"RT"===a.itineraryTypeCode}}}}}]),angular.module("fly.postbooking",[]).config(["$routeProvider",function(a){a.when("/post-booking/accept/:checkStatusToken/:static?/:debug?",{templateUrl:"components/fly/post-booking/post-booking-accept/fly-post-booking-accept.html",controller:"FlyPostBookingController"}).when("/post-booking/cancel/:checkStatusToken/:static?/:debug?",{templateUrl:"components/fly/post-booking/post-booking-cancel-itinerary/fly-post-booking-cancel-itinerary.html",controller:"FlyPostBookingController"}).when("/post-booking/email/:checkStatusToken/:static?/:debug?",{templateUrl:"components/fly/post-booking/post-booking-email-itinerary/fly-email-itinerary.html",controller:"FlyPostBookingController"}).when("/post-booking/print/:checkStatusToken/:static?/:debug?",{templateUrl:"components/fly/post-booking/post-booking-print-itinerary/fly-post-booking-print-itinerary.html",controller:"FlyPostBookingController"}).when("/post-booking/seatmap/:segmentRefId/:passengerId/:checkStatusToken*",{templateUrl:"components/fly/post-booking/post-booking-seat-map/fly-post-booking-seat-map.html",controller:"FlyPostBookingController"}).when("/post-booking/seatmap/upgrade/:checkStatusToken*",{templateUrl:"components/fly/post-booking/post-booking-seat-map/post-booking-seat-map-upgrade/fly-post-booking-seat-map-upgrade.html",controller:"FlyPostBookingController"}).when("/post-booking/checkout/:checkStatusToken/:static?/:debug?",{templateUrl:"components/fly/post-booking/post-booking-checkout/fly-post-booking-checkout.html",controller:"FlyPostBookingController"})}]),angular.module("fly.postbooking").controller("FlyPostBookingController",["$scope","$routeParams","$location","FlyCheckStatusService",function(a,b,c,d){function e(b){h=a.itinerary=b;var e=h.bookingStatus,f=e.statusCode;if(f.match(/rejected/gi)){var g=e.reasonCode;return void c.path(/reject/+g+"/"+h.checkStatusToken).replace()}a.bookingReferenceId=h.bookingReferenceId,a.customer=h.customer,a.pricingInfo=h.pricingInfo,a.slices=h.slice,a.ticketingAirline=h.ticketingAirline,a.customerServiceContact=h.customerServiceContact,i.status="success",a.airlineConfirmationCode=h.getAirlineConfirmationCode(),a.$broadcast("sync:success:FlyCheckStatus",d)}function f(){i.status="error"}function g(a){d.get(b.checkStatusToken,a).success(e).error(f)}var h=a.itinerary={},i=a.sync={status:"syncing"};a.showPostBookingPage=function(){return"success"===i.status},a.showLoading=function(){return"syncing"===i.status},a.showAjaxError=function(){return"error"===i.status},a.reSync=function(){i.status="syncing",g({forceXhr:!0})},g()}]),angular.module("fly.postbooking").directive("flyPostBookingNav",["$routeParams","pcln",function(a,b){return{restrict:"E",scope:{voidWindowClose:"@"},templateUrl:"components/fly/post-booking/post-booking-nav/fly-post-booking-nav.html",link:function(c){function d(){var a=moment(),b=moment(c.voidWindowClose);a.diff(b)>0&&g.splice(2,1)}var e="#/post-booking/",f=a.checkStatusToken+"/",g=[{title:"Print Itinerary and Receipt",url:"print/"},{title:"Email Itinerary",url:"email/"},{title:"Cancel Tickets",url:"cancel/"},{title:"Check Flight Status",url:"CHECK FLIGHT STATUS URL HERE",external:!0}],h="static"===a.static,i="debug"===a.debug;d(),c.postBookingNav=b.map(g,function(a){if(a.external===!0)return a;var b=e+a.url+f;return h&&(b+="static/"),i&&(b+="debug/"),{title:a.title,url:b}})}}}]),angular.module("fly.postbooking").controller("FlyAcceptController",["$scope","FlyBookingAcknowledgementService",function(a,b){var c=a.itinerary;a.numberInParty=c.numberInParty,a.passengers=c.passengers,a.ticketType=c.ticketType,a.airlines=c.airline,c.seatmapsAvailable&&(a.seatMapUrl="#/post-booking/seatmap/:pid/:sid/"+c.checkStatusToken),a.showInsuranceOffer=function(){return!c.pricingInfo.insurancePaid},a.showInsuranceChargeSummary=function(){return!!c.pricingInfo.insurancePaid},a.showPaperTicketTracking=function(){return"P"===a.ticketType},b.checkIn(c.checkStatusToken)}]),angular.module("fly.postbooking").directive("flyConfirmationSummary",[function(){return{restrict:"E",scope:{itinerary:"="},templateUrl:"components/fly/post-booking/post-booking-accept/confirmation-summary/fly-confirmation-summary.html",link:function(a){var b=a.itinerary.ticketType,c=a.itinerary.cancelStatus;a.voidWindowClose=a.itinerary.voidWindowClose,a.bookingReferenceId=a.itinerary.bookingReferenceId,a.noCancelErrorCode=function(){return c?!c.errorCode:!0},a.hasRetryCancelErrorCode=function(){return c?"RETRY"===c.errorCode:!1},a.hasCancelErrorCode=function(){return c?!!c.errorCode:!1},a.isInternational=function(){return a.itinerary.international===!0},a.isDomestic=function(){return a.itinerary.international!==!0},a.isElectronicTicket=function(){return"E"===b},a.isPaperTicket=function(){return"P"===b},a.ticketsProcessing=function(){return"P"===b&&!a.itinerary.paperTicketShippingInfo},a.customerServiceContact=function(){var b=a.itinerary.paymentCard,c=b.countryCode;return _.find(a.itinerary.customerServiceContact,function(a){return a.countryCode===c})||""}()}}}]),angular.module("fly.postbooking").directive("flyCommonTerms",["KanaService",function(a){return{restrict:"E",templateUrl:"components/fly/post-booking/post-booking-accept/common-terms/fly-common-terms.html",link:function(b){function c(a){for(var c in a)b.kanaContent.push(a[c]);d.status="success"}var d=b.sync={status:"syncing"};b.kanaContent=[],b.showCommonTerms=function(){return"success"===d.status},a.get("AIRPOP_COMMON_TERMS?process-common-terms=true").success(c)}}}]),angular.module("fly.postbooking").directive("flyPassengerTicketInfo",[function(){return{restrict:"E",scope:{airlineConfirmationCode:"=",bookingReferenceId:"@",passengers:"=",ticketType:"@",seatMapUrl:"@"},templateUrl:"components/fly/post-booking/post-booking-accept/passenger-ticket-information/fly-passenger-ticket-information.html",link:function(a){if(a.seatMapUrl)var b=a.seatMapUrl.replace(/:sid/,"0");a.passengerList=a.passengers.list||[],a.hasCustLoyalty=function(a){return!!a.custLoyalty},a.getSeatMapUrl=function(a){return b.replace(/:pid/,a)}}}}]),angular.module("fly.postbooking").directive("flyNeedChange",[function(){return{restrict:"E",scope:{airlineConfirmationCode:"=",customerServiceContact:"=",fareRulesUrlParams:"@",ticketingAirline:"=",customerCountryCode:"@"},templateUrl:"components/fly/post-booking/post-booking-accept/need-a-change/fly-need-a-change.html",link:function(a){a.modifyFee=30,a.questions=["What are your new travel dates?","Where will you be flying from and to?","Which specific flights are you considering?"],a.fareRulesUrl="#/fare-rules/"+a.fareRulesUrlParams,a.numbers=function(){var b=a.customerServiceContact,c=_.find(b,function(a){return"CA"===a.country});if("US"===b&&c||"US"!==b){var d=_.find(b,function(a){return"US"===a.country}),e=_.indexOf(b,d);e>-1&&b.splice(e,1)}return b}(),a.hasAirlineConfirmation=function(){return a.airlineConfirmationCode&&"Pending"!==a.airlineConfirmationCode}}}}]),angular.module("fly.postbooking").directive("flyCustomerServiceContact",[function(){return{restrict:"E",scope:{bookingReferenceId:"=",customer:"=",customerServiceContact:"="},templateUrl:"components/fly/post-booking/post-booking-accept/customer-service-contact/fly-customer-service-contact.html",link:function(a){a.customerTelephone=a.customer.phoneList[0].phoneNumber}}}]),angular.module("fly.postbooking").directive("flyImportantInfo",[function(){return{restrict:"E",scope:{itinerary:"="},templateUrl:"components/fly/post-booking/post-booking-important-information/fly-post-booking-important-information.html",link:function(a){var b=a.itinerary,c=a.pricingInfo;a.airlines=b.airline,a.kanaLinks=[{title:"Airport Check-in and Security",code:"AIRPOP_AIRPORTCHECKIN"},{title:"Notice of Incorporated Terms",code:"GPOP_INCORPTERMS"},{title:"Seat Assignments",code:"AIRPOP_SEATASSIGN"},{title:"Frequent Flyer and Royalty Programs",code:"AIRPOP_FREQFLIER"}],a.ticketingAirline=b.ticketingAirline,a.operatedBySegments=b.slice.getOperatedBySegments(),a.showDisinsectionInfo=function(){return b.international===!0&&b.disinsectionUrl},a.showOperatingAirlineInfo=function(){return a.operatedBySegments},a.showOutboundInfo=function(){return a.itinerary.segments.list>0},a.showReservedSeatingInfo=function(){return b.seatSelectionAllowed===!0},a.displayInsuranceInfo=function(){return c?!!c.insurancePaid:!1}}}}]),angular.module("fly.postbooking").service("FlyPostBookingInsuranceService",["$http","pcln",function(a,b){function c(a){return j=a}function d(){return k+p.offerToken}function e(a){f(a),console.groupCollapsed("%cSUCCESS________BOOKING BOOKING INSURANCE____________","color: #7EC500; font-weight: bold;"),console.log(a),console.groupEnd(),o=!1}function f(a){q=a[n]||a;var b=q.Invitation||q.invitation,c=q.Summary||q.summary;b&&(s={expireDate:b.expiryDate,expireTime:b.expiryTime,offerNumber:q.offerNumber,unitPrice:q.unitPrice,url:m+a.zz}),c&&(t=c,t.unitPrice=q.unitPrice)}function g(c,f){if(c||console.warn("No itinerary specified for TripInsurance get"),c.bookingReferenceId!==p.bookingReferenceId){p=c,o=!0,f=f||{};var g=d(),h="post";return f.static===!0&&(g=l,h="get"),r=a.get("post"===h?g:g),r.success(e),r}return o===!0?r:b.staticHttpPromise(!!q)}function h(){return s||!1}function i(){return t||!1}var j=null,k="/pws/v0/insurance/postbooking/",l="_data/post-booking-insurance-offer.json",m="/toursandattractions/travelInsurance.do?plf=pcln&irefid=CSPSTI_AIR_RTL&irefclickid=WWW|PCLN|Accept&zz=",n="TI",o=!1,p={},q=null,r=null,s=null,t=null,u={get:g,getInvite:h,getSummary:i};return c(u)}]),angular.module("fly.postbooking").directive("flyPostBookingInsuranceOffer",["FlyPostBookingInsuranceService",function(a){return{restrict:"E",scope:{itinerary:"="},templateUrl:"components/fly/post-booking/post-booking-insurance/fly-post-booking-insurance-offer.html",link:function(b){function c(){b.invitation=a.getInvite(),b.sync.status="success"}function d(){b.sync.status="error"}b.sync={status:"syncing"},b.aboutCoverageUrl="/air_description_of",b.timezone="EST",b.invitation=null,b.templates={1:{title:{name:"We Recommend Trip Protection",value:"Life is uncertain...plan for the unexpected.Get the following protection up to the limits listed below and much more."},badge:{name:"Trip Protection",value:"/travel/airlines/lang/en-us/images/trip_protection_air_logo.gif"},policies:[{name:"100% Trip Cancellation and Trip Interruption Protection",value:"reimburses for cancellations due to unforeseen illness of traveler, family members and traveling companions, death in the family, job loss, natural disaster at departure or destination city or other specified events."},{name:"$500 Baggage and Personal Effects",value:"reimburses for lost personal effects as well as checked baggage throughout your trip."},{name:"$50,000 Emergency Evacuation",value:"coverage pays for the cost of medical transportation to the nearest medical facility and/or to your home in the event a serious medical situation requires an evacuation."},{name:"$1,500 Medical Expense Coverage",value:" "},{name:"$10,000 Travel Accident Protection",value:" "},{name:"24/7 Hour Live Travel Assistance",value:"A real person available to assist you any time of the day with last minute flight or hotel changes, luggage locator services, cash transfers, medical assistance services and emergency services."}],doc:{name:"View terms & conditions",value:"/air_description_of_coverage"},options:[{name:"Yes",value:"Yes! I'd like to purchase Trip Protection for $AMT per person."},{name:"NO",value:"No, thanks. I prefer to decline Trip Protection."}]}},b.displayInsurance=function(){return"success"===b.sync.status&&b.invitation
},b.checkingForInsurance=function(){return"syncing"===b.sync.status},a.get(b.itinerary).success(c).error(d)}}}]),angular.module("fly.postbooking").controller("FlyPrintController",["$scope",function(a){var b=a.itinerary;a.pricingInfo=b.pricingInfo,a.numberInParty=b.numberInParty,a.ticketType=b.ticketType}]),angular.module("fly.postbooking").controller("FlyEmailController",["$scope","$location","$routeParams","$timeout","FlyEmailService","pcln",function(a,b,c,d,e,f){function g(){d(function(){b.path("/post-booking/accept/"+j.checkStatusToken)},1e3)}function h(){a.sync.status="success"}function i(){a.sync.status="error",d(g,1e3)}var j=a.itinerary;a.passengers=j.passengers,a.inputs=[{name:"email1"},{name:"email2"},{name:"email3"},{name:"email4"}],a.passengerNames=f.map(a.passengers.list,function(a){return a.firstName+" "+a.lastName}).toString().replace(/,/g,", "),a.sync={status:"default"},a.submitted=!1,a.acceptUrl="#/post-booking/accept/"+c.checkStatusToken,a.showPage=function(){return"default"===a.sync.status||"success"===a.sync.status},a.showForm=function(){return"default"===a.sync.status},a.showError=function(){return"error"===a.sync.status},a.showSuccess=function(){return"success"===a.sync.status},a.showSyncing=function(){return"syncing"===a.sync.status},a.emailIt=function(){a.submitted=!0,a.sync.status="syncing",e.email(a.inputs,j).success(h).error(i)}}]),angular.module("fly.postbooking").service("FlyEmailService",["$http","$routeParams","pcln",function(a,b,c){function d(a){return h=a}function e(b,c){return l=a.post(b,c)}function f(a,b){var d=i;return d+="?offer-num="+a.bookingReferenceId,b=c.map(b,function(a){return a.emailAddress?"&to="+a.emailAddress:""}).toString().replace(/,/g,""),d+=b}function g(a,b){var c=f(b,a);return j=b,e(c,k)}var h=null,i="/pws/v0/email-itinerary/",j=null,k=null,l=null,m={email:g};return d(m)}]),angular.module("fly.postbooking").controller("FlyCancelController",["$scope","$location","$routeParams","$timeout","pcln","FlyCancelService",function(a,b,c,d,e,f){function g(){d(function(){b.path("/post-booking/accept/"+k.checkStatusToken)},1e3)}function h(){a.sync.status="success",k.bookingStatus.statusCode.match(/voided/gi)?window.location.href="/travel/airlines/s.asp?id="+k.bookingReferenceId:i()}function i(){d(g,1e3)}function j(){a.sync.status="error",d(g,1e3)}var k=a.itinerary;a.passengers=k.passengers.list,a.slices=k.slice.list,a.voidReason={value:"",custom:"",signature:""},a.voidReasons=[{value:"Booked wrong itinerary"},{value:"Booked wrong dates"},{value:"Found better itinerary"},{value:"Found better price"},{value:"Change of plans"}],a.sync={status:"default"},a.submitted=!1,a.acceptUrl="#/post-booking/accept/"+c.checkStatusToken,a.cancelIt=function(){a.submitted=!0;var b=a.voidReason.value,c=a.voidReason.signature;return"custom"===a.voidReason.value&&(b=a.voidReason.custom),b&&c?(a.sync.status="syncing",void f.cancel(a.itinerary,{reason:b,signature:c}).success(h).error(j).fail(i)):!1},a.showPage=function(b){return a.sync.status===b},a.showSyncingPage=function(){return"syncing"===a.sync.status}}]),angular.module("fly.postbooking").service("FlyCancelService",["$http","$q","$routeParams","RequestHandler","StoredContract",function(a,b,c,d,e){function f(a){return o=a}function g(){var b=l(),c=r+s.checkStatusToken;return v=a.post(c,b)}function h(a){return console.log(a),a=a[q]||a,a.error?i(a.error):(console.groupCollapsed("____________CANCEL RESPONSE____________"),console.log(a),console.groupEnd(),angular.forEach(w._success,function(b){b.call(null,a)}),u.resolve(),void(w=null))}function i(a){x.status="fail",s.cancelStatus={errorCode:a.code,errorDescription:a.desc},angular.forEach(w._fail,function(a){a.call(null)})}function j(){x.status="error",console.groupCollapsed("____________CANCEL ERROR____________"),console.groupEnd(),angular.forEach(w._error,function(a){a.call(null)}),w=null}function k(){var a=e.create();return a.contractDateTime=new Date,a.initials=t.signature,a}function l(){var a=m(),b=k(),c={referrals:a,bookingReferenceId:s.bookingReferenceId,email:s.customer.emailAddress,commentReasonForVoid:t.value,contractInformation:b},d={};return d[p]=c,console.groupCollapsed("____________CANCEL REQUEST____________"),console.log(d),console.groupEnd(),d}function m(){var a=d.data,b=null;if(d.data){var c=a?a.referral:null,e=c?c.referralSourceId:"",f=c?c.referralId:"",g=c?c.referralClickId:"",h={},i={referralSourceId:e,refId:f,refClickId:g};h.external=i,b=[h]}return b}function n(a,c){return s=a,t=c,u=b.defer(),w=u.promise,angular.forEach(["success","error","fail"],function(a){w[a]=function(b){if(x.status===a)return void b.call();var c="_"+a;return w[c]||(w[c]=[]),w[c].push(b),w}}),g().success(h).error(j),w}var o=null,p="airVoidReq",q="airVoidRsp",r="/pws/v0/air/cancel/",s=null,t=null,u=null,v=null,w=null,x={status:null},y={cancel:n};return f(y)}]),angular.module("fly.postbooking").controller("FlyPostBookingSeatMapController",["$scope","$routeParams","FlySeatmapService","$location","FlySeatAssignmentService","FlyCheckStatusService",function(a,b,c,d,e,f){function g(b){m.status="success",a.seatmaps=b.seatMap,a.$emit("sync:success:seatmap")}function h(){m.status="error",a.$emit("sync:error:seatmap")}function i(){}function j(){f.get(a.itinerary.checkStatusToken).success(function(){d.path("/post-booking/accept/"+b.checkStatusToken)}).error(h)}function k(){m.status="error"}var l=a.itinerary,m=a.seatMapSync={status:"syncing"};a.slice=l.slice,a.seatmapUrl=l.getSeatmapUrl(),a.defaultPassengerId=b.segmentRefId,a.defaultSegmentRefId=b.passengerId,a.showLoading=function(){return"syncing"===m.status||"syncing"===a.sync.status},a.showSeatMapPage=function(){return a.showPostBookingPage()&&"success"===m.status},a.showAssigningSeats=function(){return"assigning"===m.status},a.showAjaxError=function(){return"error"===m.status||"error"===a.sync.status},a.$on("navigate:doneSelecting",function(a,c){var f="post-booking/seat-map/upgrade/"+b.checkStatusToken;c===!1?(m.status="assigning",e.assign(l).success(j).error(k)):d.path(f)}),c.get(a.itinerary).success(g).error(h),"success"!==a.sync.status?a.$on("sync:success:FlyCheckStatus",i):"success"===a.sync.status&&i()}]),angular.module("pclnApp").controller("FlyPostBookingSeatMapUpgradeController",["$scope","CreditCard",function(a,b){a.passengers=a.itinerary.passengers,a.paymentCard=new b,a.seatMapUrl=a.itinerary.getSeatmapUrl(),console.log(a.seatMapUrl)}]),angular.module("fly.postbooking").directive("flyPaperTicketTracking",[function(){return{restrict:"E",scope:{trackingInfo:"=",lastChangeDateTime:"@"},templateUrl:"components/fly/post-booking/post-booking-paper-ticket-tracking/fly-post-booking-paper-ticket-tracking.html",link:function(a){a.trackingAvailable=function(){return a.trackingInfo},a.trackingUnavailable=function(){return!a.trackingInfo}}}}]),angular.module("pclnApp").directive("flyPostBookingSummaryOfCharges",function(){return{restrict:"E",scope:{pricingInfo:"=",numberInParty:"@",ticketType:"@",acceptedInsurance:"@",bannerImage:"=",baggageFeeUrl:"@"},templateUrl:"components/fly/post-booking/post-booking-summary-of-charges/fly-post-booking-summary-of-charges.html",link:function(a){var b=a.pricingInfo;a.addedInsurance=!1,a.baseFare=b.baseFare,a.totalTaxes=b.totalTaxes,a.total=b.totalFare||b.totalTripCost,a.subtotal=a.total,a.shippingFee=b.getShippingFee(),a.processingFee=b.getProcessingFee(),a.showTicketDelivery=function(){return"P"===a.ticketType},a.showTravelInsuranceCost=function(){return b.insurancePaid}}}}),angular.module("fly").directive("flyAirlineContact",[function(){return{restrict:"E",scope:{airlines:"="},templateUrl:"components/fly/post-booking/post-booking-airline-contact/fly-airline-contact.html",link:function(){}}}]),angular.module("fly.reject",[]).config(["$routeProvider",function(a){a.when("/reject/AUTH_EXPIRED/:checkStatusToken",{templateUrl:"components/fly/reject/reject-auth-expired/fly-reject-auth-expired.html",controller:"FlyRejectController"}).when("/reject/CC_AUTH_FAILED/:checkStatusToken",{templateUrl:"components/fly/reject/reject-credit-card/reject-credit-card-auth-failed/fly-reject-credit-card-auth-failed.html",controller:"FlyRejectController"}).when("/reject/CC_DATE_EXPIRED/:checkStatusToken",{templateUrl:"components/fly/reject/reject-credit-card/reject-credit-card-auth-failed/fly-reject-credit-card-auth-failed.html",controller:"FlyRejectController"}).when("/reject/CC_INVALID_NUM/:checkStatusToken",{templateUrl:"components/fly/reject/reject-credit-card/reject-credit-card-auth-failed/fly-reject-credit-card-auth-failed.html",controller:"FlyRejectController"}).when("/reject/CC_RESTRAINT/:checkStatusToken",{templateUrl:"components/fly/reject/reject-credit-card/reject-credit-card-auth-failed/fly-reject-credit-card-auth-failed.html",controller:"FlyRejectController"}).when("/reject/CC_CALL/:checkStatusToken",{templateUrl:"components/fly/reject/reject-credit-card/reject-credit-card-auth-failed/fly-reject-credit-card-auth-failed.html",controller:"FlyRejectController"}).when("/reject/CC_INSUFFICIENT_FUND/:checkStatusToken",{templateUrl:"components/fly/reject/reject-credit-card/reject-credit-card-auth-failed/fly-reject-credit-card-auth-failed.html",controller:"FlyRejectController"}).when("/reject/CC_SEC_VALUE_FAILED/:checkStatusToken",{templateUrl:"components/fly/reject/reject-credit-card/reject-credit-card-sec-value-failed/fly-reject-credit-card-sec-value-failed.html",controller:"FlyRejectController"}).when("/reject/CC_FRAUD_SUSPECT/:checkStatusToken",{templateUrl:"components/fly/reject/reject-credit-card/reject-credit-card-sec-value-failed/fly-reject-credit-card-sec-value-failed.html",controller:"FlyRejectController"}).when("/reject/SDN_MATCH/:checkStatusToken",{templateUrl:"components/fly/reject/reject-credit-card/reject-credit-card-fraud-suspect/fly-reject-credit-card-fraud-suspect.html",controller:"FlyRejectController"}).when("/reject/PAX_ALREADY_TICKETED/:checkStatusToken",{templateUrl:"components/fly/reject/reject-pax-already-ticketed/fly-reject-pax-already-ticketed.html",controller:"FlyRejectController"}).when("/reject/POSSIBLE_DUPLICATE/:checkStatusToken",{templateUrl:"components/fly/reject/reject-possible-duplicate/fly-reject-possible-duplicate.html",controller:"FlyRejectController"}).when("/reject/NO_BOOKING/:checkStatusToken",{templateUrl:"components/fly/reject/reject.html",controller:"FlyRejectController"}).when("/reject/NO_ITINERARY/:checkStatusToken",{templateUrl:"components/fly/reject/reject.html",controller:"FlyRejectController"}).when("/reject/NO_AVAILABILITY/:checkStatusToken",{templateUrl:"components/fly/reject/reject.html",controller:"FlyRejectController"}).when("/reject/PROCESSING_FAILED/:checkStatusToken",{templateUrl:"components/fly/reject/reject.html",controller:"FlyRejectController"}).when("/reject/:reasonCode/:checkStatusToken",{templateUrl:"components/fly/reject/reject.html",controller:"FlyRejectController"})}]),angular.module("fly.reject").controller("FlyRejectController",["$scope","$location","$routeParams","FlyCheckStatusService","BookingService",function(a,b,c,d,e){function f(){try{i.bookingStatus.statusCode.match(/ACCEPTED/gi)&&b.path("/post-booking/accept/"+i.checkStatusToken).replace()}catch(a){}}function g(b){j.status="success",i=a.itinerary=b,f()}function h(){j.status="error",f()}var i=a.itinerary={},j=a.sync={status:"syncing"};a.resubmitAllowed=!1,a.resubmit=function(d){(a.resubmitAllowed===!0||d===!0)&&(a.itinerary.resubmit=!0,e.book(a.itinerary)),a.$broadcast("submitted:booking");var f="/booking/"+c.checkStatusToken;b.path(f).replace()},a.showRejectPage=function(){return"success"===j.status},a.showLoading=function(){return"syncing"===j.status},a.showAjaxError=function(){return"error"===j.status};var k=e.itinerary.itinId;(!k||k&&k!==i.itinId)&&d.get(c.checkStatusToken).success(g).error(h),a.$on("allowed:resubmit",function(b,c){a.resubmitAllowed=c})}]),angular.module("fly.reject").controller("FlyAuthExpiredController",["$scope","Doorman",function(a,b){function c(){a.resubmit()}b.signOut(),a.$on("sync:success:Doorman",c)}]),angular.module("fly.reject").controller("FlyPaxAlreadyTicketedController",["$scope",function(a){var b=a.itinerary;a.tripType=b.tripType,a.origAirport=b.origAirport,a.destAirport=b.destAirport,a.departDateTime=b.departDateTime,a.passengers=b.passengers,a.bookingReferenceId=b.bookingReferenceId,a.flightSearchUrl=b.getBackToSearchUrl()}]),angular.module("fly.reject").controller("FlyPossibleDuplicateController",["$scope",function(a){var b=a.itinerary.passengers,c=a.itinerary.itineraryTypeCode||a.itinerary.tripType;a.passengers=b?b.list:!1,a.slices=a.itinerary.slice,a.departDateTime=a.itinerary.departDateTime,a.origAirport=a.itinerary.origAirport,a.destAirport=a.itinerary.destAirport,a.prevOfferToken=a.itinerary.prevOfferToken,a.prevOfferUrl="#/post-booking/accept/"+a.prevOfferToken,a.isMultiDest=function(){return"MD"===c},a.isBookable=function(){return a.passengers!==!1},a.bookAnyway=function(){a.itinerary.useStrictDuplicate=!0,a.resubmit()},a.$emit("allowed:resubmit",!0)}]),angular.module("fly.reject").controller("FlyCreditCardAuthFailedController",["$scope","CreditCardCollection","CreditCard",function(a,b,c){function d(b,c){a.itinerary.authtoken=c.authtoken,a.signedIn.status=!0,a.customerValid=!1,a.$broadcast("signin:success",c),a.creditCards.add(c.creditcardList.list),a.customer.replaceWith(c.customer)}a.customer=a.itinerary.customer,a.creditCards=new b,a.itinerary.paymentCard=new c,a.paymentCard=a.itinerary.paymentCard,a.bookingReferenceId=a.itinerary.bookingReferenceId,a.customerValid=!1,a.paymentValid=!1,a.signedIn={status:!1},a.bookIt=function(){a.$broadcast("attempt:booking"),a.customerValid===!0&&a.paymentValid===!0&&a.resubmit(!0)},a.showReasonCode=function(b){return a.itinerary.bookingStatus.reasonCode===b},a.showCustomerForm=function(){return a.signedIn.status===!1},a.showCustomerContact=function(){return a.signedIn.status===!0},a.$on("valid:customer",function(b,c){a.customerValid=c}),a.$on("valid:payment",function(b,c){a.paymentValid=c}),a.$on("sync:success:Doorman",d)}]),angular.module("fly.reject").controller("FlySecValueFailedController",["$scope",function(a){var b=a.itinerary;a.paymentCard=b.paymentCard||{},a.paymentCard.cardCode="",a.paymentValid=!1,a.submitted=!1,a.requstedFullPayment=!1,a.reasonCode=b.bookingStatus.reasonCode,a.bookIt=function(){a.submitted=!0,a.paymentValid===!0&&a.resubmit()},a.showDefault=function(){return a.requstedFullPayment===!1},a.showFullPaymentPage=function(){return a.requstedFullPayment===!0},a.toggleFullPaymentForm=function(){a.requstedFullPayment=!a.requstedFullPayment},a.isReasonCode=function(b){return a.reasonCode===b},a.$watch("creditCardCodeForm.$valid",function(b){a.paymentValid=b,a.$emit("allowed:resubmit",b)})}]),angular.module("fly").service("FlyCheckStatusService",["$http","$q","$routeParams","pcln","Itinerary",function(a,b,c,d,e){function f(a){return j=a}function g(a){return a=a[k]||a,a.error||a.errors&&a.errors.length?h(a):(s.status="success",a.checkStatusToken=o,n=j.itinerary=new e(a),console.groupCollapsed("%cSUCCESS________CHECK STATUS RESPONSE____________","color: #7EC500; font-weight: bold;"),console.log(a),console.log(n),console.groupEnd(),void angular.forEach(r._success,function(a){a.call(null,n)}))}function h(a){s.status="error",console.groupCollapsed("%cERROR________CHECK STATUS ____________","color: #EB0000; font-weight: bold;"),console.log(a),console.log(n),console.groupEnd(),angular.forEach(r._error,function(a){a.call(null)})}function i(e,f){if(f=f||{},n&&n.checkStatusToken===e&&n._resync===!0&&(f.forceXhr=!0),o!==e||f.forceXhr===!0){s.status="syncing",o=e;var i="",j=f.static&&c.static.match(/static/g);return i=j?m:l+o,p=b.defer(),r=p.promise,angular.forEach(["success","error"],function(a){r[a]=function(b){var c="_"+a;return r[c]||(r[c]=[]),r[c].push(b),r}}),q=a.get(i).success(g).error(h),r}return o===e?d.staticHttpPromise(n):!1}var j=null,k="airCheckStatusRsp",l="/pws/v0/air/checkstatus/",m="_data/fly-check-status-ti-added.json",n=null,o=null,p=null,q=null,r=null,s={status:null},t={itinerary:n,get:i};return f(t)}]),angular.module("fly").directive("flightItinerary",function(){return{restrict:"E",scope:{slices:"=info",openJaw:"=",itineraryTypeCode:"@",seatMapUrl:"@"},templateUrl:"components/fly/flight-itinerary/flight-itinerary.html",controller:["$scope",function(a){this.getFlightName=function(b){var c="Flight",d=_.indexOf(a.slices.list,b);return c="RT"===a.itineraryTypeCode?0===d?"Departing "+c:"Returning "+c:c+" #"+b.id};var b=null;this.showDates=function(){if(b)return b;var c=!1;return angular.forEach(a.slices.list,function(a){a.travelTime.daysPadded>0&&(c=!0)}),c}}],link:function(a){var b=!1,c=null;if(a.isOpenJaw=function(){return a.openJaw},a.hasDestinationDisjoint=function(){return b===!0},"RT"===a.itineraryTypeCode){var d=a.slices.list[0],e=d.segment.list,f=e[e.length-1];c=a.slices.list[1];var g=c.segment.list[0];f.destAirport.code!==g.origAirport.code&&(b=!0,a.destinationDisjoint={arrivingAirport:f.destAirport,departingAirport:g.origAirport})}if(a.openJaw===!0){var h=a.slices.list;c=h[h.length-1];var i=c.segment.list,j=i[i.length-1].destAirport;a.openJaw={departingAirport:h[0].segment.list[0].origAirport,arrivingAirport:j}}}}}),angular.module("fly").directive("itinerarySlice",[function(){return{require:"^flightItinerary",restrict:"E",scope:{slice:"=data",openJaw:"=",seatMapUrl:"@"},templateUrl:"components/fly/flight-itinerary/slice.html",link:function(a,b,c,d){var e=a.disjointedSegments=a.slice.getDisjointedSegments();if(a.sliceName=d.getFlightName(a.slice),a.departDateTime=a.slice.departDateTime,a.arrivalDateTime=a.slice.arrivalDateTime,e.length>0){var f=e.length,g=e[f-1];if(g.sliceEnd===!0){var h=_.indexOf(e,g);a.sliceDisjoint=g,a.nextSliceName=d.getFlightName(g.nextDisjoint.slice),e.splice(h,1)}}a.hasDisjointedSegments=function(){return a.disjointedSegments.length},a.hasSliceDisjoint=function(){return a.sliceDisjoint},a.showArrivalInHeader=function(){return a.slice.travelTime.daysPadded>0}}}}]),angular.module("fly").directive("itinerarySegment",["$location",function(a){return{require:"^flightItinerary",restrict:"E",scope:{segment:"=data",openJaw:"=",seatMapUrl:"@"},templateUrl:"components/fly/flight-itinerary/segment.html",link:function(b,c,d,e){var f=b.segment;b.equipment=f.equipment,b.origAirport=f.origAirport,b.destAirport=f.destAirport,b.marketingAirline=f.marketingAirline,b.airlineLogoSrc="https://travela.priceline.com/airlines/content/images/AirLogos/"+b.marketingAirline.largeImage,b.showDates=e.showDates(),b.stopQuantity=f.stopQuantity||0,b.stopInfo=f.stopInfo;var g=f.getDurationFromDeparture();b.origDepartTimeDifference=g.origin,b.destArrivalTimeDifference=g.destination;var h=!!a.url().match(/details/gi);if(b.seatMapUrl){var i=f.id,j=b.seatMapUrl.replace(/:sid/,i);b.specificSeatmapUrl=j.replace(/:pid/,0)}var k=_.indexOf(f.collection.list,f),l=f.collection.list.length;b.highlightOrigin=function(){return!!f.prevDisjoint||!!b.openJaw&&f.sliceStart===!0&&0===k},b.highlightDestination=function(){return!!f.nextDisjoint||!!b.openJaw&&f.sliceEnd===!0&&k===l-1},b.showStopQuantity=function(){return b.stopQuantity>0},b.showStopInfo=function(){return b.segment.stopInfo},b.showSeatMapLink=function(){return!!b.seatMapUrl&&!h},b.showOriginTimeDifference=function(){return b.origDepartTimeDifference.daysPadded>0},b.showDestinationTimeDifference=function(){return b.destArrivalTimeDifference.daysPadded>0}}}}]),angular.module("fly").directive("flySeatmap",["FlySeatmapService","$location",function(a,b){return{restrict:"E",scope:{seatmapUrl:"@",passengers:"=",segment:"=",slice:"=",doneSelectingUrl:"@",defaultPassengerId:"@",defaultSegmentRefId:"@"},templateUrl:"components/fly/seatmap/fly-seatmap.html",controller:["$scope",function(a){var b=this,c=a.segment.list;a.current={segment:{},passenger:{},seatMap:{}},a.onlyGenericAvailable=!1,this.isUpgrade=function(){return a.upgrade===!0},this.setCurrentPassenger=function(b){if("string"==typeof b){b=parseInt(b,10);var c=a.passengers.list.length;(0>b||b>c-1)&&(b=0),b=_.find(a.passengers.list,function(a){return a.id===b})}b||(b=a.passengers.list[0]),a.current.passenger=b,a.$broadcast("selected:passenger",b.id)},this.getCurrentPassenger=function(){return a.passengers?a.current.passenger:!1},this.setCurrentSegment=function(b){if("string"==typeof b){b=parseInt(b,10);var c=a.segment.list.length;(0>b||b>c)&&(b=0),b=_.find(a.segment.list,function(a){return a.id===b})}b||(b=a.segment.list[0]),a.onlyGenericAvailable=b.hasSeatMap()===!1,a.current.segment=b,a.current.seatMap=b.seatmap,a.$broadcast("change:segment",b)},this.getCurrentSegment=function(){return a.current.segment},a.selectPreviousSegment=function(){var d=_.indexOf(a.segment.list,a.current.segment),e=a.segment.list.length,f=null;f=0===d?c[e-1]:c[d-1],b.setCurrentSegment(f)},a.selectNextSegment=function(){var d=_.indexOf(a.segment.list,a.current.segment),e=a.segment.list.length,f=null;f=d===e-1?c[0]:c[d+1],b.setCurrentSegment(f)},a.selectPassenger=this.setCurrentPassenger,a.selectSegment=this.setCurrentSegment}],link:function(c,d,e){function f(a){j.status="success",c.seatmaps=a.seatMap,c.selectPassenger(c.defaultPassengerId),c.selectSegment(c.defaultSegmentRefId),c.$emit("sync:success:seatmap")}function g(){j.status="error",c.$emit("sync:error:seatmap")}function h(){var a=k.split("/");angular.forEach(c.passengers.list,function(b){var c=b.id,d="";"number"==typeof c&&(c=c.toString()),angular.forEach(a,function(b,e){var f=b.split(":"),g=f[0],h=f[1];h===c&&(d+=g+":",a.splice(e,1))}),angular.forEach(b.seat,function(a){if(!a.upgrade)return!1;var b=a.segmentRefId,c=new RegExp(b+":","g"),e=!0;if(d.match(c)){var f=a.row+a.column,g=a.seatPreference,h=a.upgrade.row+a.upgrade.column,i=a.upgrade.seatPreference;(f!==h||g&&g!==i||i&&i!==g)&&(e=!1)}e===!0&&delete a.upgrade})})}function i(a,b,c){try{var d=a+":"+b+"/",e=new RegExp(d,"g"),f=k.match(e);f&&angular.forEach([k,l,function(a){a=a.replace(e,"")}]),c&&(l+=d),k+=d}catch(g){}}var j=c.sync={status:"syncing"},k="",l="";c.seats=c.passengers.getSeats(),c.upgrade=e.hasOwnProperty("upgrade"),c.allowPaid=e.hasOwnProperty("allowPaid"),c.passengers&&(c.current.passenger=c.passengers.list[0]),c.segment&&(c.current.segment=c.segment.list[0]),c.toggleNextPassenger=function(){try{var a=_.indexOf(c.passengers.list,c.current.passenger)+1,b=c.passengers.list.length,d=null;d=b>a?c.passengers.list[a]:c.passengers.list[0],c.selectPassenger(d)}catch(e){}},c.onSelectionComplete=function(){c.upgrade===!0&&h(),c.$emit("navigate:doneSelecting",l?l:!1),c.doneSelectingUrl&&b.path(c.doneSelectingUrl)},a.get(c.seatmapUrl).success(f).error(g),c.$on("selected:seat",function(a,b,d,e){c.toggleNextPassenger(),i(d,e,b.price)}),c.$on("set:generic:seat",function(a,b,d,e){c.$broadcast("set:generic:seat:"+e,b.id),i(e,b.id)})}}}]),angular.module("fly").service("FlySeatmapService",["$http","$q","SeatMap","Itinerary","pcln",function(a,b,c,d,e){function f(a){return j=a}function g(a){return t=a[k]||a,t.errors&&t.errors.length||101===t.resultCode?h(a):(n=_.map(t.seatMap,function(a){return new c(a)}),s&&s.segments.addSeatMap(n),console.groupCollapsed("%cSUCCESS________SEATMAP SERVICE____________","color: #7EC500; font-weight: bold;"),console.log(t),console.log(n),console.groupEnd(),r.status="success",angular.forEach(q._success,function(a){a.call(null,t)}),o.resolve(),void(q=null))}function h(){r.status="error",console.groupCollapsed("%cERROR________SEATMAP SERVICE___________","color: #EB0000; font-weight: bold;"),console.log(t),console.groupEnd(),angular.forEach(q._error,function(a){a.call(null)}),q=null}function i(c,f){if(f=f||{},"syncing"===r.status&&f.forceXhr!==!0)return q;var i=c,j=c instanceof d,k=!1;if(j&&(i=c.getSeatmapUrl(),k=s?s.itinId!==c.itinId:!1),m!==i||"success"!==r.status||k){r.status="syncing",m=i,j&&(s=c);var n=l+m;return o=b.defer(),q=o.promise,angular.forEach(["success","error"],function(a){q[a]=function(b){var c="_"+a;return q[c]||(q[c]=[]),q[c].push(b),q}}),p=a.get(n).success(g).error(h),q}return e.staticHttpPromise(t)}var j=null,k="airSeatmapRsp",l="/pws/v0/air/seatmap/",m=null,n=null,o=null,p=null,q=null,r={status:null},s=null,t=null,u={get:i};return f(u)}]),angular.module("fly").service("FlySeatAssignmentService",["$http","$q","$filter",function(a,b,c){function d(a){return k=a}function e(a){a=a[m]||a;try{if(a.error||a.errors.length)return f(a)}catch(b){}t.status="success",p._resync=!0,console.groupCollapsed("SUCCESS________SEAT ASSIGNMENT____________"),console.log(a),console.groupEnd(),angular.forEach(s._success,function(b){b.call(null,a)}),q.resolve(),s=null}function f(a){t.status="error",console.groupCollapsed("ERROR________SEAT ASSIGNMENT____________"),console.log(a),console.groupEnd(),angular.forEach(s._error,function(a){a.call(null)}),s=null}function g(){var b=h(),c=n;return r=a.post(c,b)}function h(){var a=i(),b={bookingReferenceId:p.bookingReferenceId,segment:a,requestId:p.requestId},c={};return c[l]=b,console.groupCollapsed("REQUEST________SEAT ASSIGNMENT____________"),console.log(c),console.groupEnd(),c}function i(){var a=p.passengers.getUpgradedSeats(),b=[],c={};angular.forEach(a,function(a){c.hasOwnProperty(a.segmentRefId)===!1?c[a.segmentRefId]={segment:a.segment,seats:[a]}:c[a.segmentRefId].seats.push(a)});var d=function(a,b){return _.map(a,function(a){var c=a.upgrade;return{column:c.column,row:c.row,id:a.passenger.refNumber,seatPreference:u(c.seatPreference),seatmapId:b}})};for(var e in c){var f=c[e],g=f.segment.seatmap,h=g?g.seatMapId:null;g&&g.errorCode&&(h=null),b.push({id:parseInt(e),origAirport:f.segment.origAirport.code,passenger:d(f.seats,h),seatProduct:f.segment.seatProduct||[]})}return b}function j(a){return t.status="syncing",o=a.checkStatusToken,p=a,q=b.defer(),s=q.promise,angular.forEach(["success","error"],function(a){s[a]=function(b){if(t.status===a)return void b.call();var c="_"+a;return s[c]||(s[c]=[]),s[c].push(b),s}}),g().success(e).error(f),s}var k=null,l="airSeatAssignReq",m="airSeatAssignRsp",n="/pws/v0/air/seatassignment",o=null,p=null,q=null,r=null,s=null,t={status:null},u=c("seatPreference"),v={assign:j};return d(v)}]),angular.module("fly").factory("SeatMap",[function(){function a(a){try{var c=a.seatMapId;angular.forEach(a.cabinClass,function(a){a.summary&&a.summary.column&&angular.forEach(a.summary.column,function(b){b.collection=a.summary.column}),angular.forEach(a.airRow,function(d){d.collection=a.airRow,d.seatmapId=c,b(d,c)})})}catch(d){}}function b(a,b){try{angular.forEach(a.airSeat,function(c){c.collection=a.airSeat,c.seatmapId=b})}catch(c){}}var c=function(b,c){c=c||{},angular.extend(this,b),a(this)};return c.prototype={},c}]),angular.module("fly").directive("flySeatMapCabin",function(){return{restrict:"E",scope:{segment:"=",passenger:"=",seats:"=",allowPaid:"="},replace:!0,templateUrl:"components/fly/seatmap/seatmap-cabin/fly-seatmap-cabin.html",controller:["$scope",function(a){this.selectSeat=function(b,c,d){if(a.passenger)try{var e=_.find(a.passenger.seat,function(b){return b.segmentRefId===a.segment.id}),f={column:c,row:b};a.upgrade===!0?(f.seat=e,e.upgrade=f):angular.extend(e,f),d=d||b+c,a.$broadcast("selected:seat",d,a.passenger.id),a.$emit("selected:seat",e,a.segment.id,a.passenger.id)}catch(g){}},this.isSeatSelected=function(b,c){var d=a.upgrade;if(a.seats){var e=_.find(a.seats,function(e){try{var f=d===!0?e.upgrade.row:null,g=d===!0?e.upgrade.column:null;f=f||e.row,g=g||e.column;var h=f+g;return e.segmentRefId===a.segment.id&&h===b+c}catch(i){}});return e?e.passenger.id:!1}return!1},this.isWing=function(a){return!!_.find(a.rowCharacteristics,function(a){return 13===a})}}],link:function(a,b,c){a.segmentRefId=a.segment.id,a.seatmapAvailable=!1,a.modalSettings={show:!1},a.seatMapAvailable=function(){return a.segment&&a.segment.seatmap},a.seatMapUnavailable=function(){return!a.segment||!a.segment.seatmap||a.segment.seatmap.errorCode},a.toggleModal=function(){a.modalSettings.show=!a.modalSettings.show},a.isEconomyClassCabin=function(a){return"ECO"===a.cabinClass},a.isBusinessClassCabin=function(a){return"BUS"===a.cabinClass},a.isFirstClassCabin=function(a){return"FST"===a.cabinClass},a.paidSeatingAvaiableAfterBooking=function(){return a.seatProduct&&!a.upgrade},a.segment&&a.segment.seatmap&&(a.cabinClass=a.segment.seatmap.cabinClass,a.seatProduct=a.segment.seatmap.seatProduct),a.$on("seat:alreadySelected",function(){a.toggleModal()}),c.hasOwnProperty("upgrade")&&(a.upgrade=!0)}}}),angular.module("fly").directive("flySeatMapRow",[function(){return{require:"^flySeatMapCabin",restrict:"E",scope:{row:"=",passenger:"="},replace:!0,templateUrl:"components/fly/seatmap/seatmap-cabin/seat-map-cabin-row/fly-seat-map-cabin-row.html",link:function(a,b,c,d){var e=a.row,f=_.indexOf(e.collection,e),g=function(){var a=!!_.find(e.airSeat[0].characteristics,function(a){return 17===a});return a}(),h=function(){var a=e.airSeat.length,b=!!_.find(e.airSeat[a-1].characteristics,function(a){return 17===a});return b}(),i=d.isWing(e),j=function(){var a=!1;if(!i)return a;try{var b=e.collection[f-1];a=d.isWing(b)===!1}catch(c){}return a}(),k=function(){var a=!1;if(!i)return a;try{var b=e.collection[f+1];a=d.isWing(b)===!1}catch(c){}return a}();a.hasLeftExit=function(){return g},a.hasRightExit=function(){return h},a.isWing=function(){return i},a.isWingTop=function(){return j},a.isWingBottom=function(){return k}}}}]),angular.module("fly").directive("flySeatMapCabinSummaryColumn",[function(){return{restrict:"E",scope:{column:"="},template:'<div class="block" ng-if="showSpacer()"><div class="spacer"></div></div><span class="block">{{column.reference}}</span>',link:function(a){var b=a.column,c=function(){if("A"!==b.position)return!1;var a=_.indexOf(b.collection,b),c=b.collection[a-1];return c?"A"===c.position:!1}();a.showSpacer=function(){return c}}}}]),angular.module("fly").directive("flySeatMapLegend",[function(){return{restrict:"E",scope:{seatMap:"="},replace:!0,templateUrl:"components/fly/seatmap/seat-map-legend/fly-seat-map-legend.html",link:function(a){function b(){if(a.seatMap){var b=a.seatMap.seatProducts;b&&(a.premiumProducts=[],angular.forEach(b,function(b){var c=b.description;("Main Cain Extra"===c||"Preferred Seats"===c)&&a.items.push({description:b.description,price:b.totalPrice.amount})}))}}a.items=[{description:"Selected Seat"},{description:"Seat Open"},{description:"Seat Taken"},{description:"Lavatories"},{description:"Bulkhead"},{description:"Exit Row"}],a.$on("change:segment",b)}}}]),angular.module("fly").directive("flySeatMapSeat",[function(){return{require:"^flySeatMapCabin",restrict:"E",scope:{seat:"=",rowData:"=row",passenger:"="},templateUrl:"components/fly/seatmap/seatmap-seat/fly-seatmap-seat.html",link:function(a,b,c,d){var e=a.seat;a.selectedPassengerId=null,a.seatNumber=a.rowData.row+e.column;var f=10===e.status,g=50!==e.status,h=_.contains(e.characteristics,42),i=_.contains(e.characteristics,17),j=function(){var b=function(a){return _.find(a,function(a){return 91===a})},c=b(a.seat.characteristics),d=a.seat.collection,e=_.indexOf(d,a.seat),f=d[e-1];if(!f)return!1;var g=b(f.characteristics);return c&&g}();if(a.selectSeat=function(){f===!0&&(null!==a.selectedPassengerId?a.$emit("seat:alreadySelected",a.seat):(d.selectSeat(a.rowData.row,e.column,a.seatNumber),a.selectedPassengerId=a.passenger.id))},a.isAvailable=function(){return f},a.isSeat=function(){return g},a.isLavatory=function(){return h},a.isExitSeat=function(){return i},a.isSelected=function(){return null!==a.selectedPassengerId},a.aisleToLeft=function(){return j},f&&g){var k=d.isSeatSelected(a.rowData.row,a.seat.column);k!==!1&&(a.selectedPassengerId=k),a.$on("selected:seat",function(b,c,d){c!==a.seatNumber&&d===a.selectedPassengerId&&(a.selectedPassengerId=null)})}}}}]),angular.module("fly").directive("flySeatMapSegmentSelectorPassenger",[function(){return{require:"^flySeatmap",restrict:"E",scope:{passenger:"=",segmentRefId:"@"},replace:!0,template:'<div class="seats"><span class="selected" ng-show="showGenericPreference()">Selected {{seat.seatPreference | seatPreference}} Seat</span><span class="selected" ng-show="showSpecificPreference()">Selected <span ng-if="!showUpgrade()">{{seat.row + seat.column}}</span><span ng-if="showUpgrade()">{{seat.upgrade.row + seat.upgrade.column || seat.row + seat.column}}</span></span><span ng-show="showNotSelected()">Not Selected</span></div>',link:function(a,b,c,d){var e=d.isUpgrade();
a.showGenericSeat=!1,a.seat=a.passenger.getSeat(a.segmentRefId),a.$on("set:generic:seat:"+a.segmentRefId,function(b,c){c===a.passenger.id&&(a.showGenericSeat=!0)}),a.showGenericPreference=function(){return!a.showSpecificPreference()&&a.showGenericSeat===!0},a.showUpgrade=function(){return e},a.showSpecificPreference=function(){var b=a.seat;return e&&b.upgrade&&(b.upgrade.row||b.upgrade.column)&&(b=b.upgrade),b.row||b.column},a.showNotSelected=function(){return!a.showSpecificPreference()&&a.showGenericSeat===!1}}}}]),angular.module("fly").directive("flySeatMapSegmentSelect",[function(){return{require:"^flySeatmap",restrict:"E",scope:{slice:"=",passenger:"=",currentSegment:"="},replace:!0,templateUrl:"components/fly/seatmap/seatmap-segment-select/fly-seatmap-segment-select.html",link:function(a,b,c,d){a.selectSegment=function(a){d.setCurrentSegment(a)},a.isActive=function(b){var c=!1;try{c=a.currentSegment.id===b}catch(d){}return c}}}}]),angular.module("fly").directive("flySeatMapPassengerSelect",[function(){return{require:"^flySeatmap",restrict:"E",scope:{passenger:"=",segmentRefId:"=",showGenericSelect:"="},templateUrl:"components/fly/seatmap/seat-map-passenger-select/fly-seat-map-passenger-select.html",link:function(a,b,c,d){function e(b){a.selected=a.passenger.id===b}var f=a.upgrade=d.isUpgrade(),g=d.getCurrentPassenger();a.currentSeat={},a.selected=!1,a.seatTypes=["A","W"],a.passenger.id>0&&a.seatTypes.push("T"),a.selectPassenger=function(){d.setCurrentPassenger(a.passenger)},a.isSelected=function(){return a.selected===!0},a.showSeatPreference=function(){return a.showGenericSelect===!0},a.showUpgrade=function(){return a.upgrade===!0},a.selectSeatPreference=function(){a.$emit("set:generic:seat",a.passenger,a.preference,a.segmentRefId)},a.$watch("segmentRefId",function(b){var c=a.currentSeat=a.passenger.getSeat(b);f&&(c.upgrade?c.upgrade.seatPreference||(c.upgrade.seatPreference=c.seatPreference):c.upgrade={seatPreference:c.seatPreference})}),a.$on("selected:passenger",function(a,b){e(b)}),g&&e(g.id)}}}]),angular.module("fly").controller("FlyFareRulesController",["$scope","$routeParams","FlyFareRulesService",function(a,b,c){function d(b){a.fareBasisInfo=b.fareBasisInfo,a.sync.status="success"}function e(){f.status="error"}var f=a.sync={status:"loading"};a.showLoading=function(){return"loading"===f.status},a.showPage=function(){return"success"===f.status},a.showAjaxError=function(){return"error"===f.status},c.get(b.itinerary).success(d).error(e)}]),angular.module("fly").service("FlyFareRulesService",["$http","$routeParams","$q","pcln",function(a,b,c,d){function e(a){return i=a}function f(a){r.status="success",q=a[j]||a,angular.forEach(p._success,function(a){a.call(null,q)}),n.resolve()}function g(){r.status="error",angular.forEach(p._error,function(a){a.call(null)})}function h(e,h){if(h=h||{},"syncing"===r.status&&h.forceXhr!==!0)return p;var i=k+e;return b.static&&b.static.match(/static/g)&&(i=l,e="static"),e!==m?(r.status="syncing",m=e,n=c.defer(),p=n.promise,angular.forEach(["success","error"],function(a){p[a]=function(b){var c="_"+a;return p[c]||(p[c]=[]),p[c].push(b),p}}),o=a.get(i).success(f).error(g),p):d.staticHttpPromise(q)}var i=null,j="airFareRulesRsp",k="/pws/v0/air/farerules/",l="_data/fly-fare-rules-response.json",m=null,n=null,o=null,p=null,q=null,r={status:null},s={get:h};return e(s)}]),angular.module("pclnApp").directive("flyAjaxError",[function(){return{restrict:"E",replace:!0,templateUrl:"components/fly/ajax-error/ajax-error.html"}}]),angular.module("fly").directive("flyAlreadyBooked",function(){return{restrict:"E",templateUrl:"components/fly/already-booked/fly-already-booked.html",link:function(a){a.bookingReferenceId=a.itinerary.bookingReferenceId}}}),angular.module("fly").service("FlyDictionary",[function(){var a={AVML:"Asian Vegetarian",BBML:"Baby Food /Infant/",BLML:"Bland",CHML:"Child Meal",DBML:"Diabetic",FPML:"Fruit Meal",GFML:"Gluten Free",HFML:"High Fiber",HNML:"Hindu - Non Vegetarian",HNVG:"Hindu/Indian Vegetarian",KSML:"Kosher",LCML:"Low Calorie",LFML:"Low Cholesterol/Fat",LPML:"Low Protein",LSML:"Low Sodium/No Salt",MOML:"Moslem",NLML:"Non-Lactose",ORML:"Oriental",PRML:"Low Purine",RFML:"Refugee Meal",RVML:"Raw Vegetarian",SAML:"Chef Salad",SFML:"Seafood",SHML:"Hot Seafood",SPML:"Special /Specify",TDML:"Toddler Meal",VGML:"Vegetarian/Non Dairy",VLML:"Vegetarian/Milk/Eggs"};return{getMealType:function(b){return b?a[b]:a}}}]),angular.module("fly").filter("itineraryTypeCode",[function(){return function(a){var b={OW:"One Way",RT:"Round Trip",MD:"Multi-Destination"};return b[a]||""}}]),angular.module("fly").filter("flyEquipment",[function(){return function(a){var b={B:"Bus",C:"Launch",H:"Helicopter",J:"Jet",L:"Limousine",P:"Piston",R:"Train",T:"Turboprop"};return b[a]||""}}]),angular.module("fly").filter("mealPreference",[function(){return function(a){var b={AVML:"Asian Vegetarian",BBML:"Baby Food /Infant/",BLML:"Bland",CHML:"Child Meal",DBML:"Diabetic",FPML:"Fruit Meal",GFML:"Gluten Free",HFML:"High Fiber",HNML:"Hindu - Non Vegetarian",HNVG:"Hindu/Indian Vegetarian",KSML:"Kosher",LCML:"Low Calorie",LFML:"Low Cholesterol/Fat",LPML:"Low Protein",LSML:"Low Sodium/No Salt",MOML:"Moslem",NLML:"Non-Lactose",ORML:"Oriental",PRML:"Low Purine",RFML:"Refugee Meal",RVML:"Raw Vegetarian",SAML:"Chef Salad",SFML:"Seafood",SHML:"Hot Seafood",SPML:"Special /Specify",TDML:"Toddler Meal",VGML:"Vegetarian/Non Dairy",VLML:"Vegetarian/Milk/Eggs"};return b[a]||void 0}}]),angular.module("fly").filter("ticketType",[function(){return function(a){return"P"===a?"Paper":"Electronic"}}]),angular.module("fly").filter("seatPreference",["$filter",function(a){return function(b){b=b?b.toUpperCase():null;var c={AISLE:"A",A:"AISLE",TOGETHER:"T",T:"TOGETHER",WINDOW:"W",W:"WINDOW"};return b=c[b],b?a("capitalize")(b):void 0}}]),angular.module("fly").directive("flySeatPreference",[function(){return{restrict:"E",scope:{passenger:"=",seatTypes:"=",defaultOption:"@",segmentRefId:"="},transclude:!0,template:'<select ng-options="seat as seat | seatPreference for seat in seatTypes" ng-model="preference" ng-change="selectSeatPreference()" ng-transclude><option value="">{{defaultOption}}</select>',link:function(a){a.selectSeatPreference=function(){a.passenger.setSeatPreference(a.preference,a.segmentRefId),a.$emit("set:generic:seat",a.passenger,a.preference,a.segmentRefId)}}}}]),angular.module("fly").filter("seatStatus",[function(){return function(a){var b={R:"Requested",P:"Requested",A:"Assigned",F:"Not Assigned",C:"Not Assigned",H:"Requested"};return b[a]||""}}]),angular.module("pclnApp").directive("signInForm",["Doorman",function(a){return{restrict:"E",replace:!0,templateUrl:"components/sign-in/sign-in-form.html",link:function(b,c){function d(){c.addClass("synced"),b.$emit("sync:success:Doorman",a.user)}function e(a){b.error=!0,c.removeClass("syncing").addClass("sync-error"),a.exception&&(b.exception=a.exception)}var f=!1;b.user={},b.signInSubmitted=!1,b.rememberMe=!0,b.error=!1,b.exception=null,b.submitted=!1,b.signIn=function(){b.signInSubmitted=!0,f===!0&&(b.syncing=!0,a.signIn(b.user,{fields:"phone,creditcard,traveler,traveler_program_membership"}).success(d).error(e))},b.showErrorMismatch=function(){return b.error===!0&&b.exception},b.$watch("signInForm.$valid",function(a){f=a,b.$emit("valid:user",a)})}}}]),angular.module("pclnApp").directive("pclnSignInModal",function(){return{restrict:"E",scope:{show:"="},templateUrl:"components/sign-in/sign-in-modal/pcln-sign-in-modal.html",link:function(){}}}),angular.module("pclnApp").service("Doorman",["$http","$q","User",function(a,b,c){function d(a){return m=a}function e(a,b){return b=b||"",b+="?fields="+a}function f(a){var b={};return b.authProvider={username:a.username,password:a.password,type:a.type||"pcln"},a.rememberMe&&(b.rememberMe=!0),b}function g(a){return a.exception?h(a):(t.status="success",p=m.user=new c(a),console.groupCollapsed("____________USER SIGN IN____________"),console.log(m.user),console.groupEnd(),angular.forEach(s._success,function(b){b.call(null,a)}),void q.resolve())}function h(a){t.status="error",-103===a.exceptionCode&&(a.exception="mismatch"),-104===a.exceptionCode&&(a.exception="generic"),angular.forEach(s._error,function(b){b.call(null,a||{})})}function i(b,c,d,e){p&&(e.forceAuth===!0?l():console.warn("A user is already signed in. Please provide the forceAuth parameter if attempting to sign in another user."));var f=p?p.username:"";return f!==d.username?a.post(b,c).success(g).error(h):void 0}function j(b){return a.get(b).success(g).error(h)}function k(a,c){if("syncing"===t.status&&c.forceXhr!==!0)return s;a=a||{},c=c||{};var d=n,g="post";c.static===!0&&(d=o,g="get"),c.fields&&(d=e(c.fields,d));var h=f(a);return q=b.defer(),s=q.promise,angular.forEach(["success","error"],function(a){s[a]=function(b){var c="_"+a;return s[c]||(s[c]=[]),s[c].push(b),s}}),console.groupCollapsed("____________USER SIGN IN REQUEST____________"),console.log(h),console.groupEnd(),r="post"===g?i(d,h,a,c):j(d),s}function l(){p&&(m.user=p=null)}var m=null,n="/pws/v0/customer/authorize",o="_data/user.json",p=null,q=null,r=null,s=null,t={status:null},u={user:p,signIn:k,signOut:l};return d(u)}]),angular.module("pclnApp").factory("User",["Model","Customer","CreditCardCollection","TravelerCollection",function(a,b,c,d){var e=function(a){for(var c in a){var d=a[c];null!==d&&void 0!==d&&"function"!=typeof d&&(this[c]=d)}var e=this.customer||{},f=e.authtoken;this.customer=new b(this.customer);var g=this.customer.travelerList;g&&(g.push(this.customer),this.setTravelers(g));var h=this.customer.creditcardList;h&&this.setcreditcardList(h),f&&(this.authtoken=f);var i=this.customer.emailAddress;i&&(this.emailAddress=i)};return e.prototype={setTravelers:function(a){angular.isArray(a)||(a=a||[a]),this.travelerList=this.customer.travelerList=new d(a)},setcreditcardList:function(a){angular.isArray(a)||(a=[a]),this.creditcardList=this.customer.creditcardList=new c(a)}},angular.extend(e.prototype,a),e}]),angular.module("pclnApp").directive("countrySelect",["Territories",function(a){return{restrict:"E",replace:!0,template:'<select ng-options="country.code as country.nm for country in countries"><option value="" selected disabled>-- Choose Country --</option></select>',link:function(b){b.countries=[],a.sync().then(function(){b.countries=a.getCountries()})}}}]),angular.module("pclnApp").directive("provinceSelect",["Territories",function(a){return{restrict:"AE",scope:{country:"="},replace:!0,template:'<select ng-show="collection.length" ng-options="option.code as option.name for option in collection"></select>',link:function(b){function c(c){var d=a.getProvinces(c);d?(b.required=!0,b.collection=d):(b.required=!1,b.collection=[]);var e="US"===c||"US_COPY"===c,f="CA"===c||"CA_COPY"===c;e||f?(b.required=!0,b.collection=e?a.getUsStates():a.getCaProvinces()):(b.required=!1,b.collection=[])}b.collection=[],b.show=!0,b.required=!1,b.$watch("country",c)}}}]),angular.module("pclnApp").directive("postalCode",["Territories",function(){return{restrict:"AE",link:function(){}}}]),angular.module("pclnApp").directive("emailConfirm",[function(){return{restrict:"A",require:"ngModel",scope:{emailConfirm:"="},link:function(a,b,c,d){function e(b){var c=!1;return b===a.emailConfirm&&(c=!0),a.value=b,d.$setValidity("emailConfirm",c),c?b:void 0}a.value=null,d.$parsers.unshift(e),a.$watch("emailConfirm",function(){e(a.value)})}}}]),angular.module("pclnApp").directive("suffixSelect",[function(){return{restrict:"A",link:function(a,b){a.suffixes=["","Senior","Junior","II","III","IV"];var c=[],d=null;_.each(a.suffixes,function(a){d='<option value="'+a+'">'+a+"</option>",c.push(d)}),b.html(c)}}}]),angular.module("pclnApp").directive("confirm",[function(){return{restrict:"A",require:"ngModel",scope:{confirming:"=confirm"},link:function(a,b,c,d){function e(b){b=b||a.value;var c=b===a.confirming;return a.value=b,d.$setValidity("confirm",c),c?b:void 0}a.value=null,d.$parsers.unshift(e),a.$watch("confirming",e)}}}]),angular.module("pclnApp").directive("selectYear",[function(){return{restrict:"E",replace:!0,transclude:!0,template:'<select ng-options="option as option for option in options"><option value="" selected disabled>Year</option></select>',link:function(a,b,c){if(!c.range)return console.warn("Please provide a range= attribute for a year-select directive"),!1;var d=c.order?c.order:"desc",e=parseInt(c.range)+1,f=0,g=(new Date).getFullYear(),h=[],i=null;for(f;e>f;f++)i="asc"===d?g+f:g-f,h.push(i);a.options=h}}}]),angular.module("pclnApp").directive("selectMonth",[function(){return{restrict:"E",replace:!0,template:'<select ng-options="option.value as option.name for option in monthOptions"><option value="" selected disabled>Month</option></select>',link:function(a){var b="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),c=[];angular.forEach(b,function(a,b){b++;var d=10>b?"0"+b:b;c.push({name:a,value:d})}),a.monthOptions=c}}}]),angular.module("pclnApp").directive("selectDay",[function(){return{restrict:"E",replace:!0,transclude:!0,template:'<select ng-options="option as option for option in dayOptions"><option value="" selected disabled>Day</option></select>',link:function(a){var b=1,c=null,d=[];for(b;31>b;b++)c=10>b?"0"+b:b,d.push(c);a.dayOptions=d}}}]),angular.module("pclnApp").service("KanaService",["$http","$routeParams","$q","pcln",function(a,b,c,d){function e(a){return m=a}function f(a){angular.forEach(a,function(a){o[a.key]=a}),t.status="success",angular.forEach(r._success,function(a){a.call(null,o)})}function g(){t.status="error",angular.forEach(r._error,function(a){a.call(null)})}function h(b){var c=i(b),d=n+c;return p=a.get(d).success(f).error(g)}function i(a){var b="",c=a.length-1;return angular.forEach(a,function(a,d){b+=a,c>d&&(b+="|")}),b}function j(a){if(angular.isArray(a)||(a=[a]),"syncing"===t.status)return a&&angular.forEach(a,function(a){s.push(a)}),r;var b=[];return angular.forEach(a,function(a){o.hasOwnProperty(a)===!1&&b.push(a)}),b.length?(t.status="syncing",q=c.defer(),r=q.promise,angular.forEach(["success","error"],function(a){r[a]=function(b){var c="_"+a;return r[c]||(r[c]=[]),r[c].push(b),r}}),p=h(b),r):d.staticHttpPromise(o)}function k(a){var b=o[a];return b?b:j(a)}function l(){return t.status}var m=null,n="/pws/v0/air/kana/",o={},p=null,q=null,r=null,s=[],t={status:null},u={get:j,getContent:k,status:l};return e(u)}]),angular.module("pclnApp").directive("kanaContent",["KanaService",function(a){return{restrict:"E",scope:{kanaCode:"@"},templateUrl:"components/kana/kana-content.html",link:function(b,c,d){function e(a){b.sync.status="success",b.kanaContent=a[b.kanaCode]}function f(){b.sync.status="error",g=null}b.kanaContent={},b.sync={status:"syncing"};var g=null;b.getAndDisplay=function(c){b.sync.status="syncing",c=g=c||g||b.kanaCode,a.get(c).success(e).error(f)},b.showContent=function(){return"success"===b.sync.status},b.showLoading=function(){return"syncing"===b.sync.status},b.showError=function(){return"error"===b.sync.status},d.autoSync===!0&&b.getAndDisplay(),b.$on("show:kana:"+b.kanaCode,function(a,c){b.getAndDisplay(c)}),c.on("click",function(a){var c=a.target,d=c.nodeName;if("KANA-LINK"===d){var e=c.getAttribute("kana-code");b.getAndDisplay(e)}})}}}]),angular.module("pclnApp").directive("kanaLink",["KanaService",function(a){return{restrict:"E",replace:!0,transclude:!0,scope:{kanaCode:"@"},templateUrl:"components/kana/kana-modal/kana-modal-link.html",link:function(b,c,d){function e(){clearTimeout(g),g=null}b.modal={show:!1};var f=d.kanaCode,g=null;b.toggleModal=function(){b.$broadcast("show:kana:"+b.kanaCode),b.modal.show=!b.modal.show},c.on("mouseover",function(){"syncing"!==a.status()&&null===g&&(g=setTimeout(e,750),a.get(f))})}}}]),angular.module("pclnApp").service("RequestHandler",["$http","$window",function(a,b){function c(a){if(f=a,!b.requestHandlerData){var c=new XMLHttpRequest;c.onreadystatechange=function(){if(4===c.readyState&&200===c.status){var a=c.responseText,b=angular.fromJson(a);g=f.data=b}};var d=angular.element(document.querySelector("head")),e="",h=_.filter(d.contents(),function(a){return 8===a.nodeType});_.each(h,function(a,b){if(a.nodeValue.match(/SETI/)){var c=b.nodeValue.replace(/SETI[^{]/,""),d=JSON.parse(c);if("object"==typeof d&&d.run&&d.run.length>0){e="?seti-experiments=";for(var f=0;f<d.run.length;f++){var g=d.run[f];e+=g.name,f<d.run.length-1&&(e+=",")}}}}),c.open("GET","/shared/php/Pcln/Web/init-app.php"+e,!1),c.send()}return console.log("requestHandlerData",g),f}function d(){return g}function e(){var a=g,b=null;if(a){var c=a?a.referral:null,d=c?c.referralSourceId:"",e=c?c.referralId:"",f=c?c.referralClickId:"",h={},i={referralSourceId:d,refId:e,refClickId:f};h.external=i,b=[h]}return b}var f=null,g={},h={data:g,get:d,getReferralsArray:e};return c(h)}]),angular.module("pclnApp").service("Territories",["$http","$q",function(a,b){function c(a){return n=a}function d(b){return b=b||{},a.get(o).success(e).error(f)}function e(a){g(a),q=!0}function f(){}function g(a){a=a||{},["countries","noZip","usStates","caProvinces"].forEach(function(b){a.hasOwnProperty(b)===!0&&(p[b]=a[b])}),p.noZip=a.noZip;var b=a.usStates;p.usStates=[];for(var c in b)p.usStates.push({code:c,name:b[c]});var d=a.caProvinces;p.caProvinces=[];for(c in d)p.caProvinces.push({code:c,name:d[c]})}function h(a){return a=a||{},a.noZip===!0?p.noZip:p.countries}function i(){return p.usStates}function j(){return p.caProvinces}function k(a){return a&&_.indexOf(p.noZip,a)<0}function l(){var a=b.defer();return q===!1?d().success(function(){a.resolve()}):a.resolve(),a.promise}function m(a){var b="US"===a||"US_COPY"===a,c="CA"===a||"CA_COPY"===a;return b||c?b?i():j():!1}var n=null,o="/_data/territories.json",p={},q=!1,r={getCountries:h,getUsStates:i,getCaProvinces:j,hasPostalCode:k,getProvinces:m,sync:l};return c(r)}]),angular.module("pclnApp").filter("creditCardSelect",["$filter",function(a){return function(b){b=b||{};var c=a("creditCardType");return"- "+c(b.cardTypeCode||b.ccTypeCode)+" - "+b.ccNumLastDigits+"-"}}]),angular.module("pclnApp").filter("bookingReferenceId",[function(){return function(a){return a?("string"!=typeof a&&(a=a.toString()),a.substring(0,3)+"-"+a.substring(3,6)+"-"+a.substring(6,9)+"-"+a.substring(9,11)):""}}]),angular.module("pclnApp").filter("stateProvince",[function(){return function(a){var b="US"===a||"US_COPY"===a,c="CA"===a||"CA_COPY"===a,d="";return b?d="State":c&&(d="Province"),d}}]),angular.module("pclnApp").filter("zipPostal",["Territories",function(a){return function(b){var c="US"===b||"US_COPY"===b,d=a.hasPostalCode(b);return d?c?"Zip":"Postal Code":""}}]),angular.module("pclnApp").filter("capitalize",[function(){return function(a){return a?a.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()}):""}}]),angular.module("pclnApp").filter("telephone",[function(){return function(a){if(!a)return"";var b=a.toString().trim().replace(/^\+/,"");if(b.match(/[^0-9]/))return a;var c,d,e;switch(b.length){case 10:c=1,d=b.slice(0,3),e=b.slice(3);break;case 11:c=b[0],d=b.slice(1,4),e=b.slice(4);break;case 12:c=b.slice(0,3),d=b.slice(3,5),e=b.slice(5);break;default:return a}return 1===c&&(c=""),e=e.slice(0,3)+"-"+e.slice(3),(c+" "+d+"-"+e).trim()}}]),angular.module("pclnApp").filter("toHtmlCase",[function(){return function(a){return a.toLowerCase().replace(/\s/gi,"-")}}]),angular.module("pclnApp").filter("passwordStrength",[function(){return function(a){var b={0:"invalid",1:"weak",2:"good",3:"strong"};return b[a]||""}}]),angular.module("pclnApp").filter("removeTrailingSlash",[function(){return function(a){return"/"===a.substr(-1)?a.substr(0,a.length-1):a}}]),angular.module("pclnApp").directive("creditCardNumber",[function(){return{restrict:"A",require:"ngModel",scope:{cardTypeCode:"="},link:function(a,b,c,d){function e(b){g=b;var c=f[a.cardTypeCode];if(c){var e=c.test(b);return a.value=b,d.$setValidity("creditCardNumber",e),e?b:void 0}}var f={VI:/^4(\d{12}|\d{15})$/,MC:/^5[1-5]\d{14}$/,AX:/^(34|37)\d{13}$/,DC:/^(30[0-5]\d{11})|(3095\d{10})|(3[689]\d{12})$/,DX:/^6011[02349]\d{11}|(60117[4789]\d{10})|(60118[6789]\d{10})|(64[456789]\d{13})|(65\d{14})$/,EN:/^(2014|2149)\d{11}$/,JC:/^(3\d{14,15})|((2131|1800)\d{11,12})$/,SW:/^(49|56|6[0-9])(\d{14}|\d{16}|\d{17})$/,BL:/^5049900000000000$/},g=null;a.value=null,d.$parsers.unshift(e),a.$watch("cardTypeCode",function(){e(a.value||g)})}}}]),angular.module("pclnApp").filter("creditCardType",[function(){return function(a){var b={AX:"American Express",DC:"Diners Club",DS:"Discover Card",MC:"MasterCard",VI:"Visa"};return b[a]||""}}]),angular.module("pclnApp").directive("cvvModalButton",[function(){return{restrict:"E",transclude:!0,templateUrl:"components/payment/cvv-modal/cvv-modal.html",link:function(a){a.modal={show:!1},a.toggleModal=function(){a.$broadcast("show:modal:cvv"),a.modal.show=!a.modal.show}}}}]),angular.module("pclnApp").directive("modal",[function(){return{restrict:"E",scope:{show:"="},replace:!0,transclude:!0,templateUrl:"components/modal/modal.html",link:function(a,b,c){var d=b.find("section")[0];c.hasOwnProperty("hide-close")&&(a.hideCloseButton=!0),a.showCloseButton=function(){return a.hideCloseButton!==!0},a.hideModal=function(){a.show=!1},b.bind("click",function(b){var c=b.target;(c===d||c.className.match(/close-modal/gi)||c.className.match(/modal-content/gi))&&(a.hideModal(),a.$apply())})}}}]),angular.module("pclnApp").service("Model",[function(){var a={set:function(a){if("object"!=typeof a)return!1;for(var b in a){var c=a[b];null!==c&&void 0!==c&&"function"!=typeof c&&(this[b]=c)}},clear:function(a){a=a||{};var b=a.ignore||"";b&&(angular.isArray(b)===!1&&(b=[b]),b=b.toString());for(var c in this){var d=new RegExp(c,"gi");"id"===c||b.match(d)||delete this[c]}},replaceWith:function(a,b){this.clear(b),angular.extend(this,a)}};return a}]),angular.module("pclnApp").factory("Collection",[function(){var a={each:function(a,b){return"function"!=typeof a?!1:void angular.forEach(this.list,function(c,d){a.apply(b,[c,d])})},find:function(a){return _.find(this.list,function(b,c){return a.apply(null,[b,c])})},map:function(a,b){return"function"!=typeof a?!1:_.map(this.list,function(c,d){return a.apply(b,[c,d])})},get:function(){},replaceAt:function(a,b,c){c=c||{};var d=c.attribute||"id",e=this.find(function(b){return b[d]===a});e=b},add:function(a){a&&!angular.isArray(a)&&(a=[a]),angular.forEach(a,function(a){this.list.push(a)},this)}};return a}]),angular.module("pclnApp").factory("Customer",["Model","pcln",function(a,b){var c=function(a){a=a||{},angular.extend(this,a),this.email&&(this.emailAddress=this.email,delete this.email),this.telephone&&(this.phoneList=this.telephone,angular.forEach(this.phoneList,function(a){a.phoneLocationType&&(a.phoneTypeCode=a.phoneLocationType,delete a.phoneLocationType)}),delete this.telephone),delete this.authtoken};return c.prototype={serialize:function(a,c){var d={email:this.emailAddress};this.phoneList&&(d.telephone=b.map(this.phoneList,function(a){return{areaCityCode:a.areaCityCode||"",countryAccessCode:a.countryAccessCode||1,phoneLocationType:a.phoneTypeCode,phoneNumber:a.phoneNumber}}));var e=this.shippingAddress||c;return(!a||e)&&((!e.creditCardID||this.shippingAddress)&&(e=b.formatAddress(e),d.address=e),this.answerText&&(d.answerText=this.answerText)),d},addShippingAddress:function(a){this.shippingAddress=a},replaceCustomer:function(a){var b=this.authtoken;this.clear(),a.authtoken=b,angular.extend(this,a)}},angular.extend(c.prototype,a),c}]),angular.module("pclnApp").factory("CreditCard",["Model","pcln",function(a,b){var c=function(a){this.ccId=_.uniqueId("cc");for(var b in a){var c=a[b];null!==c&&void 0!==c&&(this[b]=c)}!this.countryCode,this.cardNumber&&!this.ccNumLastDigits&&this.setLastDigits(),this.creditCardKey&&(this.creditCardID=this.creditCardKey,delete this.creditCardKey)};return c.prototype={serialize:function(){var a={cardCode:this.cardCode},c=this.creditCardID,d=this.ccNumSecure;if(c)a.creditCardKey=parseInt(c);else if(d){var e=this;angular.forEach(["actualCCNumLastFourDigits","address","cardHolderName","cardType","ccBinHash","ccBrandFeeTypeID","ccNumHash","ccNumLastDigits","ccNumSecure","ccTypeCode","expireDate","secureKeyID"],function(b){e[b]&&(a[b]=e[b])})}else angular.extend(a,{cardCode:parseInt(this.cardCode,10),cardHolderName:this.getFullName(),cardNumber:parseInt(this.cardNumber,10),cardType:this.cardTypeCode,expireDate:this.expirationMonth+"-"+this.expirationYear}),a.address=b.formatAddress(this);return a},setLastDigits:function(a){if(a=a||this.cardNumber,!a)return!1;var b=a.length;this.ccNumLastDigits=a.substr(b-4)},replaceWith:function(a,b){b=b||{},this.clear(),angular.extend(this,a)},getFullName:function(a){a=a||{};var b=this.middleName;a.middleInitial===!0&&b&&(b=b[0]);var c=[this.firstName,b,this.lastName,this.nameSuffix],d=_.filter(c,function(a){return a});return d.toString().replace(/,/g," ")}},angular.extend(c.prototype,a),c}]),angular.module("pclnApp").factory("CreditCardCollection",["Collection","CreditCard",function(a,b){var c=function(a,c){c=c||{},a&&!angular.isArray(a)&&(a=[a]),this.list=a||[],this.list=this.map(function(a){return new b(a)})};return c.prototype={select:function(a){var c=this.getSelected(),d=null;c&&(c.selected=!1),a instanceof b?(_.indexOf(this.list,a)<0&&this.list.push(a),d=a):d=this.find(a);try{d.selected=!0}catch(e){throw new Error("Attempting to select a credit card with an identifier when collection is empty.")}},getSelected:function(){return _.find(this.list,function(a){return a.selected===!0})},addCard:function(a,c){a=a||{},c=c||{};var d=new b(a);this.list.push(d)},find:function(a){return _.find(this.list,function(b){return b===a||b.cardId===a||b.id===b})}},angular.extend(c.prototype,a),c}]),angular.module("pclnApp").factory("Traveler",["Model","pcln","FlyDictionary","$filter",function(a,b,c,d){var e=function(a,b){b=b||{},this.pid=_.uniqueId("passenger"),angular.extend(this,a),this.surname&&(this.lastName=this.surname,delete this.surname),this.setSeats(this.seat,b.airport,b.segment);var c=d("capitalize"),e=this.personName;e&&(this.firstName=c(e.givenName),this.middleName=c(e.middleName),this.lastName=c(e.surname),this.nameSuffix=c(e.nameSuffix),delete this.personName);var f=this.custLoyalty||b.frequentFlyerPrograms;f&&this.setCustomerLoyalty(f,b.airline);var g=this.specialService;g&&this.setSpecialServices(g);var h=this.ticketNumber;h&&this.setTicketNumbers(h);var i=this.birthDate;if(i){var j=moment(i,"YYYY-MM-DD");this.birthDateDay=j.format("DD"),this.birthDateMonth=j.format("MM"),this.birthDateYear=j.format("YYYY")}};return e.prototype={serialize:function(){var a={id:this.id,gender:"M"===this.gender?"M":"F",birthDate:this.birthDateYear+"-"+this.birthDateMonth+"-"+this.birthDateDay,personName:{givenName:this.firstName,surname:this.lastName},passengerTypeCode:this.passengerTypeCode||"ADT"},c=this.middleName;c&&(a.personName.middleName=c);var d=_.filter(this.custLoyalty,function(a){return a.membershipId});d.length&&(a.custLoyalty=b.map(d,function(a){return{membershipId:a.membershipId,vendorCode:a.vendor.code}}));var e=this.nameSuffix;return e&&(a.personName.nameSuffix=e),a},getFullName:function(a){a=a||{};var b=this.middleName;a.middleInitial===!0&&b&&(b=b[0]);var c=[this.firstName,this.middleName,this.lastName,this.nameSuffix],d=_.filter(c,function(a){return a});return d.toString().replace(/,/g," ")},getAge:function(a){var b=this.birthDateDay,c=this.birthDateMonth,d=this.birthDateYear;if(!b||!c||!d)return!1;var e=moment(b+"/"+c+"/"+d,"DD/MM/YYYY"),f=moment(a);return f.diff(e,"years")},setSeats:function(a,c,e){if("string"==typeof a)return void angular.forEach(this.seat,function(b){b.seatPreference=a});var f=this;a=a||this.seats,a?this.seat=b.map(a,function(a){a.segmentOrigAirport=b.findCode(c,a.segmentOrigAirport||a.origAirport.code),a.segment=_.find(e,function(b){return b.id===a.segmentRefId}),a.passenger=f;var g=a.seatPreference;return g&&(a.seatPreference=d("seatPreference")(a.seatPreference)),a}):e&&(this.seat=b.map(e,function(a){return{seatPreference:"A",segment:a,segmentRefId:a.id,passenger:f}}))},setSeatPreference:function(a,b){if(b){var c=_.find(this.seat,function(a){return a.segmentRefId===b});c.seatPreference=a}else angular.forEach(this.seat,function(b){b.seatPreference=a||"A"})},setCustomerLoyalty:function(a,c){this.custLoyalty=b.map(a,function(a){return{membershipId:a.membershipId,vendor:_.find(c,function(b){return b.code===(a.vendorCode||a.carrierCode)})||{code:a.vendorCode}}})},setFrequentFlyerPrograms:function(a){var b=this.frequentFlyerPrograms=[];angular.forEach(a,function(a){b.push({vendorCode:a.vendorCode,name:a.vendorName,membershipId:a.membershipId||""})})},setMealPreference:function(a){var b=_.find(a,function(a){return c.getMealType(a.ssrCode)});b&&(this.mealPreference=b)},setSpecialServices:function(a){a&&this.setMealPreference(a)},setTicketNumbers:function(a){var b=[];angular.forEach(a,function(a){a&&b.push(a)}),this.ticketNumber=b},reset:function(){this.clear({ignore:"id"})},getSeat:function(a){return _.find(this.seat,function(b){return b.segmentRefId===parseInt(a,10)})},getUpgradedSeats:function(){return _.filter(this.seat,function(a){return a.upgrade})}},angular.extend(e.prototype,a),e}]),angular.module("pclnApp").factory("TravelerCollection",["Collection","Traveler","$filter",function(a,b,c){var d=function(a,c){if(this.list=[],"number"==typeof a)for(var d=0;a>d;d++)this.list.push(new b({id:d},c));else this.list=_.map(a,function(a){return new b(a,c)})};return d.prototype={serialize:function(){return _.map(this.list,function(a){return a.serialize()})},age:function(a,b){return _.filter(this.list,function(c){var d=c.getAge(b);return d?d===a:!1})},olderThan:function(a,b){return _.filter(this.list,function(c){var d=c.getAge(b);return d?d>a:!1})},yongerThan:function(a,b){return _.filter(this.list,function(c){var d=c.getAge(b);return d?a>d:!1})},getMinors:function(a){return this.yongerThan(16,a)},validate:function(){var a=[],b=this.validateNames();return b!==!0&&a.push(b),a.length>0?a:!0},validateNames:function(){var a=_.map(this.list,function(a){return a.getFullName().toLowerCase()}),b=_.filter(a,function(a){return a}),c=_.uniq(b);if(c.length!==b.length){for(var d=[],e="",f=0;f<b.length;f++)e.match(new RegExp(b[f],"gi"))?d.push(b[f]):e+="_"+b[f];return d}return!0},getGenericSeats:function(){var a=[],b=c("seatPreference");return angular.forEach(this.list,function(c){c.seat&&angular.forEach(c.seat,function(d){a.push({passengerRefId:c.id,seatType:b(d.seatPreference),segmentRefId:d.segmentRefId})})}),a.length?a:null},getSpecificSeats:function(){var a=[];return angular.forEach(this.list,function(b){if(b.seat){var c=_.filter(b.seat,function(a){return a.row&&a.column});angular.forEach(c,function(c){a.push({passengerRefId:b.id,seatNumber:c.row+c.column,segmentRefId:c.segmentRefId})})}}),a},getSeats:function(){var a=[];return angular.forEach(this.list,function(b){b.seat&&angular.forEach(b.seat,function(b){a.push(b)})}),a},getUpgradedSeats:function(){var a=[];return angular.forEach(this.list,function(b){var c=b.getUpgradedSeats();angular.forEach(c,function(b){a.push(b)})}),a}},angular.extend(d.prototype,a),d}]),angular.module("pclnApp").directive("firstName",function(){return{restrict:"A",require:"ngModel",scope:{lastName:"="},link:function(a,b,c,d){var e=null,f=function(b){b=b||e||"",e=b;var c=a.lastName||"";return b.toUpperCase()===c.toUpperCase()?(d.$setValidity("uniqueFirstLast",!1),!1):(d.$setValidity("uniqueFirstLast",!0),b)};d.$parsers.unshift(f),a.$watch("lastName",function(){f()})}}}),angular.module("pclnApp").directive("customerPassword",[function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){function e(b){var c=f(b);return a.strength!==c&&(a.strength=c,a.$emit("change:strength:password",c)),a.strength>0?(d.$setValidity("password",!0),b):(d.$setValidity("password",!1),!1)}function f(a){var b=0;if(!(0===a.length||a.length<g))return(a.match(/\d+/)||a.match(/.[!,@,#,$,%,^,&,*,?,_,~,\-,(,),`,+,=,|,},\],{,\[,',:,\.,\\,,\/,\\]/))&&b++,a.match(/[a-zA-Z]/)&&b++,a.match(/\d+/)&&a.match(/.[!,@,#,$,%,^,&,*,?,_,~,\-,(,),`,+,=,|,},\],{,\[,',:,\.,\\,\/,\\]/)&&b++,b
}a.value=null,a.strength=-1;var g=c.minLength||8;d.$parsers.unshift(e)}}}]),angular.module("fly").service("Time",[function(){function a(a,c,d){a=moment(a),c=moment(c),d=d||["seconds","minutes","hours","days","months","years","daysPadded"];var e=c.diff(a),f={},g=_.indexOf(d,"daysPadded");g>-1&&(d.splice(g,1),a=a.startOf("day"),c=c.endOf("day"),f.daysPadded=Math.abs(c.diff(a,"days")));var h=b(e,d);return angular.extend(f,h),f}function b(a,b){a=moment.duration(a),b=b||["seconds","minutes","hours","days","months","years"];var c={};return angular.forEach(b,function(b){if("daysPadded"===b);else try{c[b]=a[b]()}catch(d){console.warn(b+" is not an available Time.diff time parameter. Please check the momentjs library documentation for available moment.duration return methods. http://momentjs.com/docs/#/durations/")}}),c}return{diff:a,duration:b}}]),angular.module("pclnApp").service("Browser",["$window",function(a){function b(a){return m=a,c(),d(),e(),m}function c(){var a=navigator.userAgent,b=[{name:"iPhone",phone:!0,os:"iOS"},{name:"iPod",phone:!0,os:"iOS"},{name:"iPad",tablet:!0,os:"iOS"},{name:"Android",phone:!0,os:"Android"},{name:"Windows Phone",phone:!0,os:"Windows Phone"}];for(var c in b){var d=b[c],e=d.name,f=new RegExp(e,"gi");if(a.match(f)){q.name=e,q.os=d.os;for(var g in d)q[g]=d[g];"Android"!==e||a.match(/Mobile/i)||(q.phone=!1,q.tablet=!0)}}}function d(){for(var a=document.createElement("div"),b="Transition",c="Webkit_MS_O_Moz".split("_"),d=null,e=0,f=c.length;f>e;e++)c[e]+b in a.style&&(d=c[e]);d=d?d:"MS",n=d.toLowerCase()}function e(){var b=angular.element(a);b.on("resize",f),b.on("scroll",g),b.on("blur",h),b.on("focus",i),f()}function f(){o.width=a.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,o.height=a.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,g()}function g(){p.x.left=void 0!==a.pageXOffset?a.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,p.x.right=p.x.left+o.width,p.y.top=void 0!==a.pageYOffset?a.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop,p.y.bottom=p.y.top+o.height}function h(){o.blur=!0}function i(){o.blur=!1}function j(a){return a?o[a]:o}function k(a){return a?q[a]:q}function l(){return n}var m=null,n=null,o={width:0,height:0,blur:!1},p={x:{left:0,right:0},y:{top:0,bottom:0}};o.offset=p;var q={name:null,os:null,phone:!1,tablet:!1},r={viewport:j,userAgent:k,prefix:l};return b(r)}]),angular.module("fly").service("Base64",[function(){var a={alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",lookup:null,ie:/MSIE /.test(navigator.userAgent),ieo:/MSIE [67]/.test(navigator.userAgent),encode:function(b){var c,d,e=a.toUtf8(b),f=-1,g=e.length,h=[,,,];if(a.ie){for(var i=[];++f<g;)c=e[f+1],d=e[f+2],h[0]=e[f]>>2,h[1]=(3&e[f])<<4|e[++f]>>4,isNaN(c)?h[2]=h[3]=64:(h[2]=(15&e[f])<<2|e[++f]>>6,h[3]=isNaN(d)?64:63&e[f]),i.push(a.alphabet[h[0]],a.alphabet[h[1]],a.alphabet[h[2]],a.alphabet[h[3]]);return i.join("")}for(i="";++f<g;)c=e[f+1],d=e[f+2],h[0]=e[f]>>2,h[1]=(3&e[f])<<4|e[++f]>>4,isNaN(c)?h[2]=h[3]=64:(h[2]=(15&e[f])<<2|e[++f]>>6,h[3]=isNaN(d)?64:63&e[f]),i+=a.alphabet[h[0]]+a.alphabet[h[1]]+a.alphabet[h[2]]+a.alphabet[h[3]];return i},decode:function(b){var c=a.fromUtf8(b),d=0,e=c.length;if(a.ieo){for(result=[];e>d;)result.push(c[d]<128?String.fromCharCode(c[d++]):c[d]>191&&c[d]<224?String.fromCharCode((31&c[d++])<<6|63&c[d++]):String.fromCharCode((15&c[d++])<<12|(63&c[d++])<<6|63&c[d++]));return result.join("")}for(result="";e>d;)result+=String.fromCharCode(c[d]<128?c[d++]:c[d]>191&&c[d]<224?(31&c[d++])<<6|63&c[d++]:(15&c[d++])<<12|(63&c[d++])<<6|63&c[d++]);return result},toUtf8:function(a){var b,c=-1,d=a.length,e=[];if(/^[\x00-\x7f]*$/.test(a))for(;++c<d;)e.push(a.charCodeAt(c));else for(;++c<d;)b=a.charCodeAt(c),128>b?e.push(b):2048>b?e.push(b>>6|192,63&b|128):e.push(b>>12|224,b>>6&63|128,63&b|128);return e},fromUtf8:function(b){var c,d=-1,e=[],f=[,,,];if(!a.lookup){for(c=a.alphabet.length,a.lookup={};++d<c;)a.lookup[a.alphabet[d]]=d;d=-1}for(c=b.length;c>d&&(f[0]=a.lookup[b.charAt(++d)],f[1]=a.lookup[b.charAt(++d)],e.push(f[0]<<2|f[1]>>4),f[2]=a.lookup[b.charAt(++d)],64!=f[2])&&(e.push((15&f[1])<<4|f[2]>>2),f[3]=a.lookup[b.charAt(++d)],64!=f[3]);)e.push((3&f[2])<<6|f[3]);return e}};return{decode:a.decode,encode:a.encode}}]),angular.module("pclnApp").service("StoredContract",["Base64",function(a){function b(){return window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")),String(window.location.origin).replace("https","http")+window.location.pathname}function c(a){_.forEach(a.find("input"),function(a){var b=angular.element(a);("text"===b.attr("type")||"password"===b.attr("type")||"email"===b.attr("type"))&&("true"===b.attr(h.secureAttrName)?b.attr("value",b.val().replace(/./g,"X")):b.attr("value",b.val())),("radio"===b.attr("type")||"checkbox"===b.attr("type"))&&(a.checked?b.attr("checked","checked"):b.removeAttr("checked"))}),_.forEach(a.find("option"),function(a){var b=angular.element(a);"true"===b.parent().attr(h.secureAttrName)?b.removeAttr("selected"):a.selected?b.attr("selected","selected"):b.removeAttr("selected")})}function d(){var a="",d=b(),f=angular.element(document.head).clone(),g=angular.element(document.querySelector(h.topLevelSelector)).clone();return f.prepend(angular.element("<base>").attr("href",d)),c(g),a="<html><head>"+f.html()+"</head><body>"+e(g)+"</body></html>"}function e(a){return a.clone().wrap("<div>").parent().html()}function f(){var b=a.encode(d());return b}function g(){var a={};return a.contractDisplay=f(),a.displayWidth=window.innerWidth||1e3,a.displayHeight=window.innerHeight||1e3,a}!function(a){angular.element.prototype.clone=function(){for(var b=a.apply(this,arguments),c=this.find("textarea"),d=b.find("textarea"),e=this.find("select"),f=b.find("select"),g=0,h=c.length;h>g;g++)angular.element(d[g]).val(angular.element(c[g]).val());for(var i=0,j=e.length;j>i;i++)f[i].selectedIndex=e[i].selectedIndex;return b}}(angular.element.prototype.clone);var h={topLevelSelector:"[data-storedcontract=true]",secureAttrName:"data-issecure"};return{getCurrentPageHtml:d,create:g}}]),angular.module("pclnApp").directive("debugger",["$routeParams",function(a){return{restrict:"E",templateUrl:"components/debugger/debugger.html",controller:["$scope",function(a){this.attachDebugUnit=function(){a.logs.push({})}}],link:function(b){b.logs=[],b.showDebugger=function(){return"debug"===a.debug},b.showStaticBanner=function(){return a.hasOwnProperty("static")===!0}}}}]);